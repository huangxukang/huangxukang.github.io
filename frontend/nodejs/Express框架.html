<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Express框架 | 黄旭康的博客</title>
    <meta name="generator" content="VuePress 1.5.0">
    <link rel="shortcut icon" href="/img/huang.png">
    <meta name="description" content="黄旭康的博客">
    <link rel="preload" href="/assets/css/0.styles.9b961cba.css" as="style"><link rel="preload" href="/assets/js/app.93f8e8db.js" as="script"><link rel="preload" href="/assets/js/2.8bff3460.js" as="script"><link rel="preload" href="/assets/js/46.66055a0a.js" as="script"><link rel="prefetch" href="/assets/js/10.5a943617.js"><link rel="prefetch" href="/assets/js/11.a5a8b097.js"><link rel="prefetch" href="/assets/js/12.bee40716.js"><link rel="prefetch" href="/assets/js/13.7b0441e3.js"><link rel="prefetch" href="/assets/js/14.eaebc7c0.js"><link rel="prefetch" href="/assets/js/15.770feca4.js"><link rel="prefetch" href="/assets/js/16.56b9aeb8.js"><link rel="prefetch" href="/assets/js/17.cfdb715d.js"><link rel="prefetch" href="/assets/js/18.12657a24.js"><link rel="prefetch" href="/assets/js/19.f3bf3fb2.js"><link rel="prefetch" href="/assets/js/20.95141335.js"><link rel="prefetch" href="/assets/js/21.49c9d821.js"><link rel="prefetch" href="/assets/js/22.9955bfcb.js"><link rel="prefetch" href="/assets/js/23.b9077c80.js"><link rel="prefetch" href="/assets/js/24.ef4d714d.js"><link rel="prefetch" href="/assets/js/25.05443566.js"><link rel="prefetch" href="/assets/js/26.3d7370df.js"><link rel="prefetch" href="/assets/js/27.4cb99fd6.js"><link rel="prefetch" href="/assets/js/28.f932fd27.js"><link rel="prefetch" href="/assets/js/29.5aa98133.js"><link rel="prefetch" href="/assets/js/3.a2d73e95.js"><link rel="prefetch" href="/assets/js/30.a32d2195.js"><link rel="prefetch" href="/assets/js/31.5ded0c12.js"><link rel="prefetch" href="/assets/js/32.7f3c828e.js"><link rel="prefetch" href="/assets/js/33.f513837c.js"><link rel="prefetch" href="/assets/js/34.7beb757c.js"><link rel="prefetch" href="/assets/js/35.7b4e5c78.js"><link rel="prefetch" href="/assets/js/36.4b37ce1f.js"><link rel="prefetch" href="/assets/js/37.3cf53c55.js"><link rel="prefetch" href="/assets/js/38.31918003.js"><link rel="prefetch" href="/assets/js/39.05b8fe7d.js"><link rel="prefetch" href="/assets/js/4.c8cc242b.js"><link rel="prefetch" href="/assets/js/40.8a97ff44.js"><link rel="prefetch" href="/assets/js/41.31ab1c86.js"><link rel="prefetch" href="/assets/js/42.682d8b80.js"><link rel="prefetch" href="/assets/js/43.aeae74d4.js"><link rel="prefetch" href="/assets/js/44.4d0a6097.js"><link rel="prefetch" href="/assets/js/45.97715772.js"><link rel="prefetch" href="/assets/js/47.e0bc4ed0.js"><link rel="prefetch" href="/assets/js/48.60d7957d.js"><link rel="prefetch" href="/assets/js/49.b21f2728.js"><link rel="prefetch" href="/assets/js/5.e43cbdf3.js"><link rel="prefetch" href="/assets/js/50.c1543a6a.js"><link rel="prefetch" href="/assets/js/6.219cac7c.js"><link rel="prefetch" href="/assets/js/7.9aeaa980.js"><link rel="prefetch" href="/assets/js/8.c5521107.js"><link rel="prefetch" href="/assets/js/9.50b37756.js">
    <link rel="stylesheet" href="/assets/css/0.styles.9b961cba.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">黄旭康的博客</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/frontend/" class="nav-link router-link-active">
  FrontEnd
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Blog" class="dropdown-title"><span class="title">Blog</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://www.softeem.xin/t_blog" target="_blank" rel="noopener noreferrer" class="nav-link external">
  杨标的博客
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="http://47.98.159.95/my_blog" target="_blank" rel="noopener noreferrer" class="nav-link external">
  神三元的博客
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://muyiy.cn" target="_blank" rel="noopener noreferrer" class="nav-link external">
  木易杨前端进阶
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://www.cxymsg.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  前端面试与进阶指南
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Link" class="dropdown-title"><span class="title">Link</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://juejin.im" target="_blank" rel="noopener noreferrer" class="nav-link external">
  掘金
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://segmentfault.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  思否
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://blog.csdn.net/weixin_34345560/article/details/91457750" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Vuepress基本用法
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://blog.csdn.net/weixin_42686768/article/details/105181203" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Git基本用法
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div><div class="nav-item"><a href="https://github.com/huangxukang" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/frontend/" class="nav-link router-link-active">
  FrontEnd
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Blog" class="dropdown-title"><span class="title">Blog</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://www.softeem.xin/t_blog" target="_blank" rel="noopener noreferrer" class="nav-link external">
  杨标的博客
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="http://47.98.159.95/my_blog" target="_blank" rel="noopener noreferrer" class="nav-link external">
  神三元的博客
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://muyiy.cn" target="_blank" rel="noopener noreferrer" class="nav-link external">
  木易杨前端进阶
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://www.cxymsg.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  前端面试与进阶指南
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Link" class="dropdown-title"><span class="title">Link</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://juejin.im" target="_blank" rel="noopener noreferrer" class="nav-link external">
  掘金
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://segmentfault.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  思否
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://blog.csdn.net/weixin_34345560/article/details/91457750" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Vuepress基本用法
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://blog.csdn.net/weixin_42686768/article/details/105181203" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Git基本用法
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div><div class="nav-item"><a href="https://github.com/huangxukang" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Html</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Css</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>JavaScript</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>jQuery</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Bootstrap</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>NodeJS</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/frontend/nodejs/ECMAScript 6.html" class="sidebar-link">ECMAScript 6</a></li><li><a href="/frontend/nodejs/NodeJS异步编程.html" class="sidebar-link">NodeJS异步编程</a></li><li><a href="/frontend/nodejs/NodeJS常用模块.html" class="sidebar-link">NodeJS常用模块</a></li><li><a href="/frontend/nodejs/Express框架.html" class="active sidebar-link">Express框架</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/frontend/nodejs/Express框架.html#express安装-创建项目" class="sidebar-link">Express安装&amp;创建项目</a></li><li class="sidebar-sub-header"><a href="/frontend/nodejs/Express框架.html#express处理get请求" class="sidebar-link">Express处理get请求</a></li><li class="sidebar-sub-header"><a href="/frontend/nodejs/Express框架.html#express页面渲染" class="sidebar-link">Express页面渲染</a></li><li class="sidebar-sub-header"><a href="/frontend/nodejs/Express框架.html#express向页面传递数据" class="sidebar-link">Express向页面传递数据</a></li><li class="sidebar-sub-header"><a href="/frontend/nodejs/Express框架.html#router路由操作" class="sidebar-link">Router路由操作</a></li><li class="sidebar-sub-header"><a href="/frontend/nodejs/Express框架.html#service业务逻辑操作" class="sidebar-link">Service业务逻辑操作</a></li><li class="sidebar-sub-header"><a href="/frontend/nodejs/Express框架.html#express静态文件区域" class="sidebar-link">Express静态文件区域</a></li><li class="sidebar-sub-header"><a href="/frontend/nodejs/Express框架.html#express-art-template分布式视图" class="sidebar-link">Express-art-template分布式视图</a></li><li class="sidebar-sub-header"><a href="/frontend/nodejs/Express框架.html#前台向后台提交数据" class="sidebar-link">前台向后台提交数据</a></li><li class="sidebar-sub-header"><a href="/frontend/nodejs/Express框架.html#后台接收前台提交的数据" class="sidebar-link">后台接收前台提交的数据</a></li><li class="sidebar-sub-header"><a href="/frontend/nodejs/Express框架.html#express文件上传" class="sidebar-link">Express文件上传</a></li><li class="sidebar-sub-header"><a href="/frontend/nodejs/Express框架.html#express文件下载" class="sidebar-link">Express文件下载</a></li><li class="sidebar-sub-header"><a href="/frontend/nodejs/Express框架.html#express验证码生成" class="sidebar-link">Express验证码生成</a></li><li class="sidebar-sub-header"><a href="/frontend/nodejs/Express框架.html#express的session使用" class="sidebar-link">Express的session使用</a></li><li class="sidebar-sub-header"><a href="/frontend/nodejs/Express框架.html#express的弹窗消息使用" class="sidebar-link">Express的弹窗消息使用</a></li><li class="sidebar-sub-header"><a href="/frontend/nodejs/Express框架.html#nodejs配置启动信息" class="sidebar-link">NodeJS配置启动信息</a></li><li class="sidebar-sub-header"><a href="/frontend/nodejs/Express框架.html#express创建服务器-补充" class="sidebar-link">Express创建服务器[补充]</a></li><li class="sidebar-sub-header"><a href="/frontend/nodejs/Express框架.html#express对cookie的操作" class="sidebar-link">Express对Cookie的操作</a></li><li class="sidebar-sub-header"><a href="/frontend/nodejs/Express框架.html#express实现中转服务器" class="sidebar-link">Express实现中转服务器</a></li><li class="sidebar-sub-header"><a href="/frontend/nodejs/Express框架.html#express返回json" class="sidebar-link">Express返回JSON</a></li><li class="sidebar-sub-header"><a href="/frontend/nodejs/Express框架.html#express请求方式" class="sidebar-link">Express请求方式</a></li><li class="sidebar-sub-header"><a href="/frontend/nodejs/Express框架.html#express多功能请求方式" class="sidebar-link">Express多功能请求方式</a></li><li class="sidebar-sub-header"><a href="/frontend/nodejs/Express框架.html#express接收前台传值总结" class="sidebar-link">Express接收前台传值总结</a></li><li class="sidebar-sub-header"><a href="/frontend/nodejs/Express框架.html#分页的补充" class="sidebar-link">分页的补充</a></li><li class="sidebar-sub-header"><a href="/frontend/nodejs/Express框架.html#回调地址应用" class="sidebar-link">回调地址应用</a></li><li class="sidebar-sub-header"><a href="/frontend/nodejs/Express框架.html#nodemon插件应用" class="sidebar-link">nodemon插件应用</a></li><li class="sidebar-sub-header"><a href="/frontend/nodejs/Express框架.html#nodejs-express-mysql-jwt接口安全验证" class="sidebar-link">nodejs+express+mysql+jwt接口安全验证</a></li><li class="sidebar-sub-header"><a href="/frontend/nodejs/Express框架.html#mvc开发模式" class="sidebar-link">MVC开发模式</a></li></ul></li><li><a href="/frontend/nodejs/Egg框架.html" class="sidebar-link">Egg框架</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Sass</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="express框架"><a href="#express框架" class="header-anchor">#</a> Express框架</h1> <blockquote><p><a href="http://www.expressjs.com.cn/" target="_blank" rel="noopener noreferrer">Express<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><a href="http://www.expressjs.com.cn/changelog/4x.html#4.16.3" target="_blank" rel="noopener noreferrer">4.16.3<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>基于 <a href="https://nodejs.org/en/" target="_blank" rel="noopener noreferrer">Node.js<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 平台，快速、开放、极简的 <code>Web</code>开发框架</p> <p>主要的目的就是使用<code>NodeJS</code>快速的创建<code>Web</code>服务器（不能做到全局异常处理，就需要<code>try</code>...<code>catch</code>）</p></blockquote> <h2 id="express安装-创建项目"><a href="#express安装-创建项目" class="header-anchor">#</a> Express安装&amp;创建项目</h2> <ul><li><p>初始化项目</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">npm</span> init <span class="token function">yes</span>
<span class="token punctuation">(</span>$ <span class="token function">npm</span> init -y<span class="token punctuation">)</span>
</code></pre></div></li> <li><p>安装 <code>express</code></p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">npm</span> <span class="token function">install</span> express --save
<span class="token punctuation">(</span>$ <span class="token function">npm</span> <span class="token function">install</span> express -S<span class="token punctuation">)</span>
</code></pre></div></li> <li><p>在项目的目录下，创建<code>app.js</code>,完成如下代码</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// express是用于创建Web服务器的一个框架 Web Application</span>
<span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;express&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">// 执行express()方法，生成一个app程序，这个app程序就是项目的程序</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
</code></pre></div></li> <li><p>创建好<code>Web</code>项目，启动<code>Express</code>服务器</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 启动服务器，监听一个端口号</span>
app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8888</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
   console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;服务器创建成功&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li> <li><p>启动 <code>Express</code>项目</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ node app.js
</code></pre></div></li></ul> <h2 id="express处理get请求"><a href="#express处理get请求" class="header-anchor">#</a> Express处理get请求</h2> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">//app.get()处理服务器的get请求</span>
app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>resp</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token comment">// req:request   代表浏览器到服务器（客户端到服务器）</span>
    <span class="token comment">// resp:response 代表服务器到客户端 </span>
    <span class="token comment">// resp.send()   服务器向浏览器发送了文本信息</span>
    resp<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&quot;你的请求我收到了，我现在给你回了个消息&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;/login&quot;</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>resp</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    resp<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&quot;这是登陆页面&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;/register&quot;</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>resp</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    resp<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&quot;这是一个注册页面&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;/login&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> resp</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> htmlStr <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
        &lt;h2 style=&quot;text-align:center;color:blue&quot;&gt;登陆页面&lt;/h2&gt;
        &lt;input type=&quot;text&quot; placeholder=&quot;请输入用户名&quot;&gt;
        &lt;br /&gt;
        &lt;button type=&quot;button&quot;&gt;我要登陆&lt;/button&gt;
    </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
    resp<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>htmlStr<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;/register&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> resp</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> htmlStr <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
        &lt;h2 style=&quot;text-align:center;color:red&quot;&gt;注册页面&lt;/h2&gt;
        &lt;input type=&quot;text&quot; placeholder=&quot;请输入用户名&quot;&gt;
        &lt;br /&gt;
        &lt;button type=&quot;button&quot;&gt;我要注册&lt;/button&gt;
    </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
    resp<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>htmlStr<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p><code>Express</code>通过<code>app.get()</code>的方式来处理浏览器发送过来的请求</p> <table><thead><tr><th>浏览器</th> <th>服务器</th></tr></thead> <tbody><tr><td><code>http://127.0.0.1:8888/</code></td> <td>app.get(&quot;/&quot;)</td></tr> <tr><td><code>http://127.0.0.1:8888/login</code></td> <td>app.get(&quot;/login&quot;)</td></tr> <tr><td><code>http://127.0.0.1:8888/register</code></td> <td>app.get(&quot;/register&quot;)</td></tr></tbody></table> <blockquote><p>浏览器地址栏的请求<strong>永远都是<code>get</code>请求</strong></p></blockquote> <h2 id="express页面渲染"><a href="#express页面渲染" class="header-anchor">#</a> Express页面渲染</h2> <blockquote><p><code>Express</code>如果要进行页面渲染需要使用第三方模块，如<code>ejs</code>，<code>jade</code>或目前比较流行的<code>art-template</code></p></blockquote> <p>在当前的项目下新建文件夹<code>views</code>，这个文件夹只存放<code>html</code>文件，借助第三方模块<code>art-template</code>完成页面的渲染，将这个页面发送给请求者</p> <p><code>Express</code>如果要与<code>art-template</code>结合 ，则需要安装下面两个包</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">npm</span> <span class="token function">install</span> art-template express-art-template --save
</code></pre></div><p>安装完成以后，进行模块引擎的配置</p> <p><strong>第一步：设置视图文件所在的位置</strong></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;path&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 设置模板引擎视图文件所在的位置</span>
app<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;views&quot;</span><span class="token punctuation">,</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">&quot;./views&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>第二步：设置模板渲染引擎</strong></p> <p>因为<code>Express</code>没有模板渲染引擎，所以需要用户手动设置模板渲染引擎</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 导入模板渲染引擎</span>
<span class="token keyword">const</span> template<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;express-art-template&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 设置模板后缀名.html</span>
app<span class="token punctuation">.</span><span class="token function">engine</span><span class="token punctuation">(</span><span class="token string">&quot;html&quot;</span><span class="token punctuation">,</span>template<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 设置模板引擎所有的html文件都会通过template渲染</span>
app<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;view engine&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;html&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>当设置完成以后，如果希望向前台渲染一个模板文件，这时直接调用<code>resp.render()</code>方法</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> resp</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 把views文件夹下面的index.html文件显示在用户的浏览器上面</span>
    <span class="token comment">// 上面已经设置app.set(&quot;views&quot;,path.join(__dirname,&quot;./views&quot;))视图文件所在的位置</span>
    <span class="token comment">// 上面已经设置app.engine(&quot;html&quot;,template)告诉程序，模板的后缀名是.html</span>
    <span class="token comment">// 所以可以将resp.render(&quot;views/index.html&quot;)写为下面的形式</span>
    resp<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">&quot;index&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;/stuList&quot;</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>resp</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token comment">// 当请求这个的时候，渲染一个模板出去,模板的名称最好与请求的名称保持一致</span>
    resp<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">&quot;stuList&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="express向页面传递数据"><a href="#express向页面传递数据" class="header-anchor">#</a> Express向页面传递数据</h2> <p>当通过模板引擎渲染页面时，页面经常会有一些数据，这些数据怎么获取得到呢</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">//学生列表</span>
app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;/stuList&quot;</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>resp</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token comment">// 当请求这个的时候，渲染一个模板出去,模板的名称最好与请求的名称保持一致</span>
    <span class="token keyword">let</span> arr<span class="token operator">=</span><span class="token punctuation">[</span>
        <span class="token string">&quot;张三&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;李四&quot;</span>
    <span class="token punctuation">]</span><span class="token punctuation">;</span>
    resp<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">&quot;stuList&quot;</span><span class="token punctuation">,</span><span class="token punctuation">{</span>abc<span class="token operator">:</span>arr<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>main<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>title<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>学生列表<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>hr</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">&gt;</span></span>
        {{each abc item index}}
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>{{item}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
        {{/each}}
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>现在通过读取数据库的数据，向页面传递以后显示</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 导入数据库操作模块</span>
<span class="token keyword">const</span> DBUtil <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./utils/DBUtil.js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//学生列表</span>
app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;/stuList&quot;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> resp</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token comment">// 当请求这个的时候，渲染一个模板出去,模板的名称最好与请求的名称保持一致</span>
        <span class="token keyword">let</span> strSql <span class="token operator">=</span> <span class="token string">&quot;select * from stuinfo&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token keyword">await</span> DBUtil<span class="token punctuation">.</span><span class="token function">executeSql</span><span class="token punctuation">(</span>strSql<span class="token punctuation">)</span><span class="token punctuation">;</span>
        resp<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">&quot;stuList&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>abc<span class="token operator">:</span> result<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
        resp<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        resp<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&quot;服务器错误&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="router路由操作"><a href="#router路由操作" class="header-anchor">#</a> Router路由操作</h2> <p>在上面的代码里，所有的请求都会到达<code>app</code>，通过<code>app.get()</code>的方式进行处理，但是不可能把所有的代码都写在<code>app.js</code>这个文件里面，这样会显得很臃肿</p> <p><img src="/img/nodejs/Express-1.png" alt="Express-1"></p> <p>可以把路由理解成上面的这样的图，之前浏览器所有的请求都应该在<code>app.js</code>里面处理，现在通过某一种方式 ，把它下发到下面的每个模块，在这个模块里面，也可以处理请求，这样做有以下几个好处</p> <ol><li>代码不用全部都写在<code>app.js</code>里面，可以根据模块划分成不同的路由，这样整个项目结构清淅</li> <li>如果进行团队项目，每个人负责的模块不同，在开发过程当中，每个人只需要负责不同的文件</li></ol> <p><strong>路由的本质可以理解为app的子集，与app一样，都是用于处理客户端发送过来的请求，只处理req与resp</strong></p> <h3 id="router路由的创建"><a href="#router路由的创建" class="header-anchor">#</a> Router路由的创建</h3> <p>路由是<code>app</code>的子集，<code>app</code>则是通过<code>Express()</code> 创建的，所以就找<code>Express()</code></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// StuInfoRoute.js文件</span>
<span class="token comment">// const express = require(&quot;express&quot;);</span>
<span class="token comment">// const router = express.Router();</span>
<span class="token keyword">const</span> router<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;express&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;/List&quot;</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>resp</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token comment">// ......</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
module<span class="token punctuation">.</span>exports<span class="token operator">=</span>router<span class="token punctuation">;</span>
</code></pre></div><p>得到路由以后，这个路由所具备的方法与<code>app</code>所具备的方法一样，同样用<code>get()</code>与<code>post()</code>来处理客户发送过来的 <code>get/post</code> 请求</p> <p>一个路由创建成功以后，要与<code>app.js</code>保持一定的联系，这时在<code>app.js</code>去加载这个路由</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">&quot;/StuInfo&quot;</span><span class="token punctuation">,</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./router/StuInfoRoute.js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>加载这个路由以后，就可以通过下面的地址进入</p> <div class="language-http extra-class"><pre class="language-http"><code><span class="token header-name keyword">http:</span>//127.0.0.1:8888/StuInfo/List
</code></pre></div><p><img src="/img/nodejs/Express-2.png" alt="Express-2"></p> <h2 id="service业务逻辑操作"><a href="#service业务逻辑操作" class="header-anchor">#</a> Service业务逻辑操作</h2> <p>在项目里，会涉及到相应的业务逻辑操作，例如数据库的增删改查等，这些操作专门新建一个文件夹，用专门的文件去处理，这些文件对象我们叫<code>Service</code>操作</p> <p><code>Service</code>主要的目的是为<code>Router</code>提供服务，**提供与数据库操作相关的服务。**所以与数据库操作相关的东西全部都在这里，按照正常开发模式，一个数据表会对应一个<code>Service</code></p> <p><strong>BaseService</strong></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">/** 
 * @description 基础业务逻辑操作配置信息
 */</span>

<span class="token keyword">const</span> DBUtil <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;../utils/DBUtil.js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> appConfig <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;../config/appConfig.js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @class BaseService
 */</span>
<span class="token keyword">class</span> <span class="token class-name">BaseService</span> <span class="token keyword">extends</span> <span class="token class-name">DBUtil</span> <span class="token punctuation">{</span>
    <span class="token comment">/**
     * @param {string} tableName 数据表名称 
     */</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">tableName</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>tableName <span class="token operator">=</span> tableName<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>pageSize <span class="token operator">=</span> appConfig<span class="token punctuation">.</span>pageSize<span class="token punctuation">;</span> <span class="token comment">// 分页页容量</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * @name getList 获取所有人员列表
     * @returns {promise} 返回executeSql执行的promise
     */</span>
    <span class="token function">getAllList</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> strSql <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">select * from </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>tableName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> where isDel=false</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
        <span class="token comment">//返回的是一个promise</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">executeSql</span><span class="token punctuation">(</span>strSql<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * @name createCountSql 生成count总数的SQL语句
     * @param {string}} strWhere 查询条件 
     * @returns {string} countSql 生成好的SQL语句
     */</span>
    <span class="token function">createCountSql</span><span class="token punctuation">(</span><span class="token parameter">strWhere</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> countSql <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">select count(*) 'totalCount' from </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>tableName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> where isDel=false </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>strWhere<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">  </span><span class="token template-punctuation string">`</span></span>
        <span class="token keyword">return</span> countSql<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> BaseService<span class="token punctuation">;</span>
</code></pre></div><blockquote><p><code>BaseService</code>提供了数据库操作的公共方法，让所有的操作都继承这个<code>BaseService</code>，这样可以大大的降低代码的冗余量</p></blockquote> <p><strong>StuInfoService</strong></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">/**
 * @description 数据表stuinfo的相关操作配置信息
 */</span>

<span class="token keyword">const</span> BaseService <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./BaseService.js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @class StuInfoService 数据表stuinfo的数据操作
 * @extends BaseService 继承基础Service
 */</span>
<span class="token keyword">class</span> <span class="token class-name">StuInfoService</span> <span class="token keyword">extends</span> <span class="token class-name">BaseService</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token string">&quot;stuinfo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * @name getListByPage 分页查询方法
     * @returns {Promise} 返回executeSql 执行的Promise
     */</span>
    <span class="token function">getListByPage</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>
        sid<span class="token punctuation">,</span>
        sname<span class="token punctuation">,</span>
        ssex<span class="token punctuation">,</span>
        cid<span class="token punctuation">,</span>
        pageIndex
    <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 默认情况下，pageIndex不会有值</span>
        pageIndex <span class="token operator">=</span> pageIndex <span class="token operator">||</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> strWhere <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>sid<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 学号有值，%模糊查询</span>
            strWhere <span class="token operator">+=</span> <span class="token string">&quot; and stuinfo.sid like '%&quot;</span> <span class="token operator">+</span> sid <span class="token operator">+</span> <span class="token string">&quot;%'&quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>sname<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            strWhere <span class="token operator">+=</span> <span class="token string">&quot; and stuinfo.sname like '%&quot;</span> <span class="token operator">+</span> sname <span class="token operator">+</span> <span class="token string">&quot;%'&quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>ssex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            strWhere <span class="token operator">+=</span> <span class="token string">&quot; and stuinfo.ssex='&quot;</span> <span class="token operator">+</span> ssex <span class="token operator">+</span> <span class="token string">&quot;'&quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>cid<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            strWhere <span class="token operator">+=</span> <span class="token string">&quot; and stuinfo.cid='&quot;</span> <span class="token operator">+</span> cid <span class="token operator">+</span> <span class="token string">&quot;'&quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">let</span> strSql <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">SELECT stuinfo.*,classinfo.cname FROM stuinfo INNER JOIN classinfo on stuinfo.cid=classinfo.cid where stuinfo.isDel=false </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>strWhere<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> limit ?,?</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> countSql <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">createCountSql</span><span class="token punctuation">(</span>strWhere<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 执行两条sql语句</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">executeSql</span><span class="token punctuation">(</span>strSql <span class="token operator">+</span> <span class="token string">&quot;;&quot;</span> <span class="token operator">+</span> countSql<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">(</span>pageIndex <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token keyword">this</span><span class="token punctuation">.</span>pageSize<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>pageSize<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * @name checkSid 检测学号是否存在
     * @param {string} sid 需要检测的学号
     * @returns {boolean} true为存在，false为不存在
     */</span>
    <span class="token keyword">async</span> <span class="token function">checkSid</span><span class="token punctuation">(</span><span class="token parameter">sid</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> strSql <span class="token operator">=</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">createCountSql</span><span class="token punctuation">(</span><span class="token string">&quot; and sid=? &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// select count(*) `totalCount` from stuinfo where isDel =false and sid =?</span>
        <span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">executeSql</span><span class="token punctuation">(</span>strSql<span class="token punctuation">,</span> <span class="token punctuation">[</span>sid<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>totalCount <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">//存在</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token comment">//不存在</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * @name addStuInfo 新增学生信息
     * @returns {Promise} 返回executeSql执行的Promise
     */</span>
    <span class="token function">addStuInfo</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>
        sid<span class="token punctuation">,</span>
        sname<span class="token punctuation">,</span>
        ssex<span class="token punctuation">,</span>
        sbirthday<span class="token punctuation">,</span>
        snation<span class="token punctuation">,</span>
        sIDCard<span class="token punctuation">,</span>
        saddr<span class="token punctuation">,</span>
        smail<span class="token punctuation">,</span>
        stel<span class="token punctuation">,</span>
        cid<span class="token punctuation">,</span>
        sphoto
    <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> strSql <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">INSERT INTO </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>tableName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> (sid, sname, ssex, sbirthday, snation, sIDCard, saddr, smail, stel, cid,sphoto) VALUES (?,?,?,?,?,?,?,?,?,?,?)</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">executeSql</span><span class="token punctuation">(</span>strSql<span class="token punctuation">,</span> <span class="token punctuation">[</span>sid<span class="token punctuation">,</span> sname<span class="token punctuation">,</span> ssex<span class="token punctuation">,</span> sbirthday<span class="token punctuation">,</span> snation<span class="token punctuation">,</span> sIDCard<span class="token punctuation">,</span> saddr<span class="token punctuation">,</span> smail<span class="token punctuation">,</span> stel<span class="token punctuation">,</span> cid<span class="token punctuation">,</span> sphoto<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * @name deleteStuBySid 根据学号删除学生信息
     * @param {Array} cksValue 需要删除的学生id
     * @returns {Boolean} true删成功，false删除失败
     */</span>
    <span class="token keyword">async</span> <span class="token function">deleteStuBySid</span><span class="token punctuation">(</span><span class="token parameter">cksValue</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> cksValueString <span class="token operator">=</span> cksValue<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">&quot;','&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 将isDel改为true</span>
        <span class="token comment">// update stuinfo set isDel=true where sid in('xxx','xxx','xxx')</span>
        <span class="token keyword">let</span> strSql <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">update </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>tableName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> set isDel=true where sid in('</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>cksValueString<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">')</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">executeSql</span><span class="token punctuation">(</span>strSql<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">.</span>affectedRows <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * @name findBySid 根据学号查询学生信息
     * @param {string} sid 学生的学号
     * @returns {Promise} executeSql执行的结果
     */</span>
    <span class="token function">findBySid</span><span class="token punctuation">(</span><span class="token parameter">sid</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> strSql <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">select * from </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>tableName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> where isDel=false and sid = ? </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">executeSql</span><span class="token punctuation">(</span>strSql<span class="token punctuation">,</span> <span class="token punctuation">[</span>sid<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * @name editStuInfoBySid 根据学号编辑学生信息
     * @returns {boolean} true代表编辑成功 false代表编辑失败
     */</span>
    <span class="token keyword">async</span> <span class="token function">editStuInfoBySid</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>
        sname<span class="token punctuation">,</span>
        ssex<span class="token punctuation">,</span>
        sbirthday<span class="token punctuation">,</span>
        snation<span class="token punctuation">,</span>
        sIDCard<span class="token punctuation">,</span>
        saddr<span class="token punctuation">,</span>
        smail<span class="token punctuation">,</span>
        stel<span class="token punctuation">,</span>
        cid<span class="token punctuation">,</span>
        sid
    <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> strSql <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">UPDATE sms.stuinfo SET sname=?, ssex=?, sbirthday=?, snation=?, sIDCard=?, saddr=?, smail=?, stel=?, cid=? WHERE sid=? </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">executeSql</span><span class="token punctuation">(</span>strSql<span class="token punctuation">,</span> <span class="token punctuation">[</span>sname<span class="token punctuation">,</span> ssex<span class="token punctuation">,</span> sbirthday<span class="token punctuation">,</span> snation<span class="token punctuation">,</span> sIDCard<span class="token punctuation">,</span> saddr<span class="token punctuation">,</span> smail<span class="token punctuation">,</span> stel<span class="token punctuation">,</span> cid<span class="token punctuation">,</span> sid<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">.</span>affectedRows <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * @name exportToExcel 导出为Excel
     * @param {Promise} 返回executeSql执行的Promise
     */</span>
    <span class="token function">exportToExcel</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>
        sid<span class="token punctuation">,</span>
        sname<span class="token punctuation">,</span>
        ssex<span class="token punctuation">,</span>
        cid
    <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> strWhere <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>sid<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            strWhere <span class="token operator">+=</span> <span class="token string">&quot; and stuinfo.sid like '%&quot;</span> <span class="token operator">+</span> sid <span class="token operator">+</span> <span class="token string">&quot;%'&quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>sname<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            strWhere <span class="token operator">+=</span> <span class="token string">&quot; and stuinfo.sname like '%&quot;</span> <span class="token operator">+</span> sname <span class="token operator">+</span> <span class="token string">&quot;%'&quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>ssex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            strWhere <span class="token operator">+=</span> <span class="token string">&quot; and stuinfo.ssex='&quot;</span> <span class="token operator">+</span> ssex <span class="token operator">+</span> <span class="token string">&quot;'&quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>cid<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            strWhere <span class="token operator">+=</span> <span class="token string">&quot; and stuinfo.cid='&quot;</span> <span class="token operator">+</span> cid <span class="token operator">+</span> <span class="token string">&quot;'&quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">let</span> strSql <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">SELECT stuinfo.*,classinfo.cname FROM stuinfo INNER JOIN classinfo on stuinfo.cid=classinfo.cid where stuinfo.isDel=false </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>strWhere<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">executeSql</span><span class="token punctuation">(</span>strSql<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> StuInfoService<span class="token punctuation">;</span>
</code></pre></div><p><img src="/img/nodejs/Express-3.png" alt="Express-3"></p> <h2 id="express静态文件区域"><a href="#express静态文件区域" class="header-anchor">#</a> Express静态文件区域</h2> <blockquote><p>本质是因为<code>Express</code>里面所有的文件都被控制器控制，而控制器可以理解为<code>Router</code>与<code>app</code></p></blockquote> <p><code>Express</code>里面所有的请求都被<code>Router</code>或<code>app</code>接管，这时所有的请求都必须经过<code>Router</code>或<code>app</code>的同意，否则请求不到，这时有些特殊的文件不需要经过它们处理，如图片，<code>JS</code>文件与<code>CSS</code>文件等，针对这种情况，<code>Express</code>会设置一个静态区域，让这些文件不受控制 ，可以直接访问</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">&quot;/public&quot;</span><span class="token punctuation">,</span>express<span class="token punctuation">.</span><span class="token function">static</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">&quot;./public&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>这时<code>public</code>下面的文件夹就公开了，再请求这些文件就不再需要使用控制器</p> <h2 id="express-art-template分布式视图"><a href="#express-art-template分布式视图" class="header-anchor">#</a> Express-art-template分布式视图</h2> <p><code>Express</code>的<code>art-template</code>里，可以使用<code>include</code>去包含一个子视图</p> <div class="language-html extra-class"><pre class="language-html"><code>&lt;%
    var pageTitle = { pageTitle:&quot;学生信息&quot; }
%&gt;
<span class="token comment">&lt;!-- art-template分布模板（模板片段化） --&gt;</span>
{{include &quot;../layout_header.html&quot; pageTitle}}
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!-- ...... --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
{{include &quot;../layout_footer.html&quot;}}
</code></pre></div><ul><li><p>子模板默认共享父级模板的数据，同时也可以单独传递数据过去，上面的<code>layout_header.html</code>就使用了父级模板传递过去的数据<code>obj</code></p></li> <li><p>在上面的模板里，有两种语法，第一种是<code>&lt;% %&gt;</code>语法，可以书写原生的<code>JS</code>代码，第二种是<code></code>语法，书写起来更方便。在模板里面去书写原生<code>JS</code>代码，例如定义变量，执行<code>for</code>循环等</p></li></ul> <div class="language-html extra-class"><pre class="language-html"><code><span class="token comment">&lt;!-- 通用分页，子级模板页默认共享父级模板页的数据，同时父级模板页也可以单独传递数据给子级模板页 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>clearfix<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>pagination pull-right<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!-- art-template原始语法，同时给当前页码加上颜色标注 --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">data-pageindex</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>1<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>#<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>首页<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
        &lt;%for(var i=pageModel.pageStart;i&lt;=pageModel.pageEnd;i++){%&gt;
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>{{pageModel.pageIndex==i?'active':''}}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">data-pageindex</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>{{i}}<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>#<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>{{i}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
        &lt;%}%&gt;
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">data-pageindex</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>{{pageModel.pageCount}}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>尾页<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>这两种语法根据不同的情况去书写，可以混合在一起</p> <p>分布式视图可以极大的对页面模块进行分割，更有利于页面的模块化</p> <h2 id="前台向后台提交数据"><a href="#前台向后台提交数据" class="header-anchor">#</a> 前台向后台提交数据</h2> <p>前端向后端提交数据的方式目前主要有两种</p> <ul><li><p>第一种是通过<code>Ajax</code> 提交 ，核心是创建一个<code>XMLHttpRequest</code>的对象，在后台默默地提交，所以<code>Ajax</code>也叫<strong>无刷新请求</strong></p></li> <li><p>第二种方式则是最基本的通过 <code>form</code> 表单提交</p> <ol><li><p><code>value</code>属性是表单元素存放值的属性</p></li> <li><p>所有的表单元素最好放在表单标签<code>form</code>里面</p></li> <li><p><code>form</code>标签常用属性</p> <ul><li><p><code>action</code>代表提交到后台的地址</p></li> <li><p><code>method</code>代表提交方式</p></li></ul></li> <li><p>表单里的数据提交到后台的时，通过表单元素<code>name</code>连接，表单提交时会自动将<code>name</code>与<code>value</code>连接在一起<code>?name=value&amp;name=value</code>，后台通过<code>name</code>取值</p></li> <li><p><strong>form表单提交会跳转页面</strong></p></li></ol></li></ul> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>/StuInfo/doAddStu<span class="token punctuation">&quot;</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>get<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>userName<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>submit<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        提交数据
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>当上面的表单点击提交按钮以后，会将表单里的数据提交到 <code>action</code> 的地址<code>/StuInfo/doAddStu</code>， 通过<code>get</code>的方式提交</p> <h2 id="后台接收前台提交的数据"><a href="#后台接收前台提交的数据" class="header-anchor">#</a> 后台接收前台提交的数据</h2> <ul><li><strong>get方式提交过来的值</strong></li></ul> <blockquote><p><code>req.query</code>只接收<code>get</code>传值</p></blockquote> <p>无论是在<code>app.js</code>里还是在某个路由里，都会通过<code>app.get()或router.get()</code>来处理前端通过<code>get</code>方式提交 过来的请求，如果想获取提交过来的参数，可以找<code>req</code>这个对象，所有提交过来的参数都在<code>req.query</code>这个对象里，如果前台提交了<code>userName=yangbiao</code>，那么后台在这里就是<code>req.query.userName</code></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">let</span> userName<span class="token operator">=</span>req<span class="token punctuation">.</span>query<span class="token punctuation">.</span>userName<span class="token punctuation">;</span>
<span class="token comment">// 在项目里都是直接解构解出来</span>
<span class="token keyword">let</span> <span class="token punctuation">{</span>userName<span class="token punctuation">}</span><span class="token operator">=</span>req<span class="token punctuation">.</span>query<span class="token punctuation">;</span>
</code></pre></div><ul><li><strong>post方式提交过来的值</strong></li></ul> <blockquote><p><code>req.body</code>只接收<code>post</code>传值</p></blockquote> <p><code>Express</code>默认情况下支持<code>get</code>取值而不支持<code>post</code>取值，如果想让<code>Express</code>支持<code>post</code>取值 ，则需要使用第三方插件（中间件）<code>body-parser</code></p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">npm</span> <span class="token function">install</span> body-parser --save
</code></pre></div><p>在<code>app.js</code>里加载插件</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> bodyParser <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;body-parser&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// post取值插件</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>bodyParser<span class="token punctuation">.</span><span class="token function">urlencoded</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    extended<span class="token operator">:</span> <span class="token boolean">false</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>bodyParser<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    limit<span class="token operator">:</span> <span class="token string">'10mb'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>现在就可以通过<code>req.body</code>接收前面<code>post</code>传递过来的值</p> <h2 id="express文件上传"><a href="#express文件上传" class="header-anchor">#</a> Express文件上传</h2> <p><code>Express</code>本身不支持文件上传 ，如果要使用文件上传需要依赖于第三方模块<code>multer</code></p> <h3 id="multer安装"><a href="#multer安装" class="header-anchor">#</a> multer安装</h3> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">npm</span> <span class="token function">install</span> multer --save
</code></pre></div><p>使用Form表单进行提交时，如果要使用文件上传，只能够使用<code>post</code>请求,同时还需对表单的属性<code>enctype=&quot;multipart/form-data&quot;</code>进行设置</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>/StuInfo/doAddStu<span class="token punctuation">&quot;</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>POST<span class="token punctuation">&quot;</span></span> <span class="token attr-name">enctype</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>multipart/form-data<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>file<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>sphoto<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>sphoto<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><blockquote><p><code>enctype</code>全称是<code>EncodeType</code>，指定将数据回发到服务器时浏览器使用的编码类型,默认值是<code>application/x-www-form-urlencoded</code>，如果要使用文件上传要将这个值设置为<code>multipart/form-data</code></p></blockquote> <p><strong>题外话</strong>：之前已经使用了<code>body-parse</code>来处理<code>post</code>请求，但是<code>body-parse</code>只能够处理<code>Content-Type</code>为<code>application/x-www-form-urlencoded</code>或<code>application/json</code> 的，现在文件上传的<code>Content-Type</code>设置成了<code>multipart/form-data</code>就需要使用第三方包<code>multer</code>来进行</p> <h3 id="multer配置使用"><a href="#multer配置使用" class="header-anchor">#</a> multer配置使用</h3> <p><strong>第一步：配置模块</strong></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> multer <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;multer&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> upload <span class="token operator">=</span> <span class="token function">multer</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    dest<span class="token operator">:</span> appConfig<span class="token punctuation">.</span>uploadImgs <span class="token comment">// 设置上传文件保存的文件夹</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>调用<code>multer</code>方法，设置上传文件的文件夹</p> <p><strong>第二步：加载插件</strong></p> <p>在接收文件的<code>Express</code>路由上添加模块插件</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>router<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&quot;/doAddStuInfo&quot;</span><span class="token punctuation">,</span> upload<span class="token punctuation">.</span><span class="token function">single</span><span class="token punctuation">(</span><span class="token string">&quot;sphoto&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> resp</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// upload.single()接收前台传来的单一文件（多个为array）</span>
    <span class="token comment">// ......</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><code>upload.single(&quot;sphoto&quot;)</code>代表接收单个文件，里面的参数<code>sphoto</code>代表文件的<code>name</code></p> <p><strong>第三步：接收文件</strong></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>router<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&quot;/doAddStuInfo&quot;</span><span class="token punctuation">,</span> upload<span class="token punctuation">.</span><span class="token function">single</span><span class="token punctuation">(</span><span class="token string">&quot;sphoto&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> resp</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// upload.single()接收前台传来的单一文件（多个为array）</span>
    <span class="token comment">// 接收到前面表单提交过来的数据，将这些数据存到数据库</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token comment">// 接收单一文件，如果用户没有上传文件，则是undefined</span>
        <span class="token keyword">let</span> file <span class="token operator">=</span> req<span class="token punctuation">.</span>file<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>file<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 接收到文件，重命名文件并加上后缀名，全局唯一标识符GUID</span>
            fs<span class="token punctuation">.</span><span class="token function">renameSync</span><span class="token punctuation">(</span>file<span class="token punctuation">.</span>path<span class="token punctuation">,</span> file<span class="token punctuation">.</span>path <span class="token operator">+</span> file<span class="token punctuation">.</span>originalname<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">let</span> imgPath <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/uploadImgs/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>file<span class="token punctuation">.</span>filename <span class="token operator">+</span> file<span class="token punctuation">.</span>originalname<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
            req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>sphoto <span class="token operator">=</span> imgPath<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// let stuInfoService = new StuInfoService();</span>
        <span class="token keyword">let</span> stuInfoService <span class="token operator">=</span> ServiceFactory<span class="token punctuation">.</span><span class="token function">createStuInfoService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token keyword">await</span> stuInfoService<span class="token punctuation">.</span><span class="token function">addStuInfo</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">.</span>affectedRows <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 新增成功，跳转到列表页</span>
            <span class="token comment">// resp.send(`&lt;script&gt;alert(&quot;新增成功&quot;);location.href=&quot;/StuInfo/List&quot;;&lt;/script&gt;`);</span>
            <span class="token comment">// resp.redirect(&quot;/StuInfo/List&quot;);</span>
            MessageBox<span class="token punctuation">.</span><span class="token function">alertAndRedirect</span><span class="token punctuation">(</span><span class="token string">&quot;新增成功&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;/StuInfo/List&quot;</span><span class="token punctuation">,</span> resp<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token comment">// 新增失败，后退回上一页</span>
            <span class="token comment">// resp.send(`&lt;script&gt;alert('新增失败');history.back();&lt;/script&gt;`);</span>
            MessageBox<span class="token punctuation">.</span><span class="token function">alertAndBack</span><span class="token punctuation">(</span><span class="token string">&quot;新增失败&quot;</span><span class="token punctuation">,</span> resp<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        resp<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&quot;服务器错误&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>将收到的<code>file</code>打印结果列出如下</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span> 
 fieldname<span class="token operator">:</span> 'sphoto'<span class="token punctuation">,</span>
 originalname<span class="token operator">:</span> 'item<span class="token number">1.</span>jpg'<span class="token punctuation">,</span>
 encoding<span class="token operator">:</span> '<span class="token number">7</span>bit'<span class="token punctuation">,</span>
 mimetype<span class="token operator">:</span> 'image/jpeg'<span class="token punctuation">,</span>
 destination<span class="token operator">:</span> 'D<span class="token operator">:</span>\\H<span class="token number">1904</span>\\<span class="token number">1007</span>\\code\\StudentManager\\uploadImgs'<span class="token punctuation">,</span>
 filename<span class="token operator">:</span> '<span class="token number">5</span>c<span class="token number">089e0717009</span>a<span class="token number">03570556e494</span>d<span class="token number">65</span>dd<span class="token number">3</span>'<span class="token punctuation">,</span>
 path<span class="token operator">:</span>
  'D<span class="token operator">:</span>\\H<span class="token number">1904</span>\\<span class="token number">1007</span>\\code\\StudentManager\\uploadImgs\\<span class="token number">5</span>c<span class="token number">089e0717009</span>a<span class="token number">03570556e494</span>d<span class="token number">65</span>dd<span class="token number">3</span>'<span class="token punctuation">,</span>
 size<span class="token operator">:</span> <span class="token number">48228</span> 
<span class="token punctuation">}</span>
</code></pre></div><ul><li><code>originalname</code>代表文件的原始名称</li> <li><code>path</code>代表当前文件存在什么地方</li> <li><code>filename</code>代表当前文件的名子</li></ul> <p>注意文件的新名子没有后缀名，要给文件添加一个后缀名</p> <p>当图片上传到服务器，并且保存到数据库后，就要公开这个文件夹，以方便浏览器能够访问到这张图片</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">&quot;/uploadImgs&quot;</span><span class="token punctuation">,</span>express<span class="token punctuation">.</span><span class="token function">static</span><span class="token punctuation">(</span>appConfig<span class="token punctuation">.</span>uploadImgs<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;uploadImgs上传图片夹已公开&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="express文件下载"><a href="#express文件下载" class="header-anchor">#</a> Express文件下载</h2> <blockquote><p>将生成好的文件导出以后要从服务器发送到浏览器，可以使用<code>Express</code>里面的两个方法向浏览器发送文件</p> <ul><li><code>resp.sendFile()</code></li> <li><code>resp.download()</code></li></ul></blockquote> <p>上面的两个方法都可以发送文件到浏览器</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 导出学生信息为Excel文件</span>
router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;/exportToExcel&quot;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> resp</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token comment">// let stuInfoService = new StuInfoService();</span>
        <span class="token keyword">let</span> stuInfoService <span class="token operator">=</span> ServiceFactory<span class="token punctuation">.</span><span class="token function">createStuInfoService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token keyword">await</span> stuInfoService<span class="token punctuation">.</span><span class="token function">exportToExcel</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>query<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 准备一个文件名</span>
        <span class="token keyword">let</span> excelName <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;.xlsx&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> excelPath <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>appConfig<span class="token punctuation">.</span>excelDirectory<span class="token punctuation">,</span> excelName<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 生成Excel文件</span>
        ExcelUtil<span class="token punctuation">.</span><span class="token function">resultToExcel</span><span class="token punctuation">(</span>result<span class="token punctuation">,</span> excelPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 将文件发送到浏览器，提供用户下载</span>
        resp<span class="token punctuation">.</span><span class="token function">download</span><span class="token punctuation">(</span>excelPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        resp<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&quot;服务器错误&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>上面的代码是将生成好的<code>excel</code>文件发送到浏览器，这里使用<code>resp.download()</code>方法</p> <h2 id="express验证码生成"><a href="#express验证码生成" class="header-anchor">#</a> Express验证码生成</h2> <blockquote><p><code>Express</code>框架里，无法生成图片，但是可以使用<code>SVG</code>的形式生成图片验证码，<code>SVG</code>是一种新的图片格式，在<code>NodeJS</code>里可以借助于<code>svg-captcha</code>这个模块来完成图片验证码</p></blockquote> <p><strong>第一步：安装模块</strong></p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">npm</span> <span class="token function">install</span> svg-captcha --save
</code></pre></div><p><strong>第二步：创建普通验证码</strong></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> svgCaptcha <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'svg-captcha'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 从服务器请求一张图片，Vcode(validate code)验证码图片</span>
router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;/getVcode&quot;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> resp</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 调用模块，生成验证码图片</span>
    <span class="token keyword">let</span> svgData <span class="token operator">=</span> svgcaptcha<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        size<span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span>
        noise<span class="token operator">:</span> <span class="token number">3</span>
        <span class="token comment">// color:true</span>
        <span class="token comment">// background:&quot;yellow&quot;</span>
        <span class="token comment">// ignoreChars: &quot;0123456789&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">/*
        得到SVG的图片对象信息
        {
            text:&quot;ABCD&quot;,
            data:&quot;&lt;svg&gt;&lt;/svg&gt;&quot;
        }
     */</span>
    <span class="token comment">// 将生成好的验证码放到session里面，同时转大写</span>
    req<span class="token punctuation">.</span>session<span class="token punctuation">.</span>VCode <span class="token operator">=</span> svgData<span class="token punctuation">.</span>text<span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 设置svg响应头</span>
    resp<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">&quot;Content-Type&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;image/svg+xml&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// data属性就是svg图片的数据</span>
    resp<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>svgData<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>调用 <code>create()</code> 之后，会返回一个对象，结构如下：<code>{data:'',text:''}</code>。</p> <ul><li><code>data</code>：验证码 svg 图片</li> <li><code>text</code>: 验证码字符</li></ul> <p><strong>create()的参数如下：</strong></p> <ul><li><code>size: 4</code> 验证码长度</li> <li><code>ignoreChars: '0o1i'</code> 验证码字符中排除 <code>0o1i</code></li> <li><code>noise: 1</code> 干扰线条的数量</li> <li><code>color: true</code> 验证码的字符是否有颜色，默认没有，如果设定了背景，则默认有</li> <li><code>background: '#cc9966'</code> 验证码图片背景颜色</li></ul> <p>示例</p> <p><img src="/img/nodejs/Express-4.jpg" alt="Express-4"></p> <p><strong>创建算数式验证码</strong></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> cap <span class="token operator">=</span> svgCaptcha<span class="token punctuation">.</span><span class="token function">createMathExpr</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span>
</code></pre></div><p>示例：</p> <p><img src="/img/nodejs/Express-5.jpg" alt="Express-5"></p> <h3 id="在express-中使用"><a href="#在express-中使用" class="header-anchor">#</a> 在Express 中使用</h3> <p>在网页中使用验证码时，请求一个 <code>URL</code> ，返回一张验证码图片</p> <ol><li><p><code>Express</code>中构建 <code>/getVCode</code>的路由</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> router <span class="token operator">=</span> express<span class="token punctuation">.</span><span class="token function">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> captcha <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'svg-captcha'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/getVCode'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
  <span class="token keyword">const</span> cap <span class="token operator">=</span> captcha<span class="token punctuation">.</span><span class="token function">createMathExpr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  req<span class="token punctuation">.</span>session<span class="token punctuation">.</span>captcha <span class="token operator">=</span> cap<span class="token punctuation">.</span>text<span class="token punctuation">;</span> <span class="token comment">// session 存储</span>
  resp<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">&quot;Content-Type&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;image/svg+xml&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 响应的类型</span>
  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>cap<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li> <li><p>前端使用</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>/Main/getVCode<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>VCodeImg<span class="token punctuation">&quot;</span></span> <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>验证码<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre></div></li> <li><p>点击切换码</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 点击刷新验证码</span>
<span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;#VCodeImg&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> src <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">&quot;src&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 在请求的地址 ? 后面加上一个随机数，这样每次请求的SRC都不一样，这样img就会重新发起请求</span>
    <span class="token comment">// 重新发起请求就相当于重新获取验证码</span>
    <span class="token function">$</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">&quot;src&quot;</span><span class="token punctuation">,</span> src<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/\?.*/g</span><span class="token punctuation">,</span> <span class="token string">&quot;?&quot;</span> <span class="token operator">+</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li></ol> <h2 id="express的session使用"><a href="#express的session使用" class="header-anchor">#</a> Express的session使用</h2> <blockquote><p><code>session</code>是服务器的存储机制，它可以在服务器上开辟一个独立的互不干扰的空间去存储数组，这个空间不受客户端的请求的影响，每个<code>session</code>代表浏览器与服务器的连接</p></blockquote> <p><code>Express</code>默认不支持<code>session</code>，依赖于第三方模块<code>express-session</code></p> <p><strong>第一步：安装</strong></p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">npm</span> <span class="token function">install</span> express-session --save
</code></pre></div><p><strong>第二步：加载模块，配置Session</strong></p> <p><code>app.js</code>文件</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> session <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;express-session&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 加载session插件，连接浏览器与服务器</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">session</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token comment">// 是否加密</span>
    secret<span class="token operator">:</span> <span class="token string">&quot;huangxukang&quot;</span><span class="token punctuation">,</span>
    <span class="token comment">// 是否可以重新保存</span>
    resave<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    saveUninitialized<span class="token operator">:</span> <span class="token boolean">false</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>第三步： session的使用</strong></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 检测管理员登录</span>
router<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&quot;/checkLogin&quot;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> resp</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 在这里接收前台传过来的用户名，密码和验证码</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> <span class="token punctuation">{</span>
            userName<span class="token punctuation">,</span>
            userPwd
        <span class="token punctuation">}</span> <span class="token operator">=</span> req<span class="token punctuation">.</span>body<span class="token punctuation">;</span>
        <span class="token comment">// let adminInfoservice = new AdminInfoservice();</span>
        <span class="token keyword">let</span> adminInfoservice <span class="token operator">=</span> ServiceFactory<span class="token punctuation">.</span><span class="token function">createAdminInfoService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token keyword">await</span> adminInfoservice<span class="token punctuation">.</span><span class="token function">checkLogin</span><span class="token punctuation">(</span>userName<span class="token punctuation">,</span> userPwd<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 把当前用户的登录信息记录到系统的session里面</span>
            req<span class="token punctuation">.</span>session<span class="token punctuation">.</span>userInfo <span class="token operator">=</span> result<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token comment">// 登陆成功,跳转到主页面</span>
            resp<span class="token punctuation">.</span><span class="token function">redirect</span><span class="token punctuation">(</span><span class="token string">&quot;/Main/Index&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token comment">// 登录失败</span>
            MessageBox<span class="token punctuation">.</span><span class="token function">alertAndBack</span><span class="token punctuation">(</span><span class="token string">&quot;用户名或密码错误，请重试&quot;</span><span class="token punctuation">,</span> resp<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        resp<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&quot;服务器错误&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p><code>session</code>可以赋值，也可以取值，它是互不干扰的独立部分</p> <h3 id="通过session与拦截器实现登录验证"><a href="#通过session与拦截器实现登录验证" class="header-anchor">#</a> 通过session与拦截器实现登录验证</h3> <blockquote><p><code>Express</code>默认支持拦截器，可以在某一个点上拦截请求，也可以在某一个路由上拦截请求</p></blockquote> <p><strong><code>Express</code>的拦截器最好写在路由前面，这样就是全局的拦截器，同时也要写在<code>/public</code>静态路径后面，因为所有的静态路径都要放行</strong></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 拦截器设置在路由的前面，以便对所有的路由进行拦截，同时还需要设置在/public后面，express默认支持拦截器</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> resp<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>req<span class="token punctuation">.</span>session<span class="token punctuation">.</span>userInfo<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 用户有登录</span>
        <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">// 用户没有登录</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>appConfig<span class="token punctuation">.</span>excludePath<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>path<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 如果当前访问的路径包含在排除的数组里面，不需要登录就可以放行</span>
            <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token comment">// 跳转到登录页，相当于302重定向</span>
            resp<span class="token punctuation">.</span><span class="token function">redirect</span><span class="token punctuation">(</span><span class="token string">&quot;/Main/Login&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li><p>登录成功的信息放置在<code>session</code>里，只需在拦截器里判断是否有登录的<code>session</code>信息就可以，如果没有，就做进一步的判断</p></li> <li><p>同时有一点非常重要，在这里面要对一些特殊的路径放行，例如当用户输入的是登录页时，要对这个请求进行放行，让用户去登录（如果不放行，这个时候，用户连登录也进不去了，这就会造成一个死循环【我没登录你不让我进，我要去登录你又不让我进】），为了对特殊的路径放行，把要放行的路径信息写在数组里，放在<code>appConfig.js</code>这个文件里</p></li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">/**
 * @description 程序配置信息
 */</span>

<span class="token keyword">let</span> appConfig <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token comment">// ......</span>
    excludePath<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token string">&quot;/Main/Login&quot;</span><span class="token punctuation">,</span>                <span class="token comment">// 登录页面路径</span>
        <span class="token string">&quot;/Main/getVCode&quot;</span><span class="token punctuation">,</span>             <span class="token comment">// 登录页面验证码路径</span>
        <span class="token string">&quot;/AdminInfo/checkVCode&quot;</span><span class="token punctuation">,</span>      <span class="token comment">// 检测用户名与密码路径</span>
        <span class="token string">&quot;/AdminInfo/checkLogin&quot;</span><span class="token punctuation">,</span>      <span class="token comment">// 检测验证码路径</span>
        <span class="token string">&quot;/Main/fromDing&quot;</span><span class="token punctuation">,</span>             <span class="token comment">// 钉钉扫码后回调路径</span>
        <span class="token string">&quot;/AdminInfo/doBindUser&quot;</span>       <span class="token comment">// 通过钉钉绑定管理员账号  </span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> appConfig<span class="token punctuation">;</span>
</code></pre></div><h2 id="express的弹窗消息使用"><a href="#express的弹窗消息使用" class="header-anchor">#</a> Express的弹窗消息使用</h2> <blockquote><p><code>Express</code>本身不支持对浏览器进行消息提示的功能 ，可以通过自定义的方式来完成</p></blockquote> <p>思路是对<code>resp.send()</code>方式的使用，通过这个方法，可以向页面发送字符串，所以也可以向页面发送<code>JS</code>脚本代码</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>resp<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;script&gt;alert(&quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>这是弹出消息<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot;);&lt;/script&gt;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
resp<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;script&gt;alert(&quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>这是弹出消息<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot;);history.back();&lt;/script&gt;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
resp<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;script&gt;alert(&quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>这是弹出消息<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot;);location.href=&quot;/Main/Index&quot;;&lt;/script&gt;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>可以将上面的方法进行封装，在需要的地方进行调用</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">/**
 * @description 消息弹窗配置信息
 */</span>

<span class="token comment">/**
 * @class MessageBox 消息弹窗
 */</span>
<span class="token keyword">class</span> <span class="token class-name">MessageBox</span> <span class="token punctuation">{</span>
   <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&quot;当前对象不允许new调用&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   <span class="token comment">/**
    * @name alertAndBack 弹窗消息并跳转到指定页面
    * @param {string} msg 弹出的消息
    * @param {string} url 跳转的页面
    * @param {*} resp Response对象
    */</span>
   <span class="token keyword">static</span> <span class="token function">alertAndRedirect</span><span class="token punctuation">(</span><span class="token parameter">msg<span class="token punctuation">,</span> url<span class="token punctuation">,</span> resp</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      resp<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;script&gt;alert(&quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>msg<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot;);location.href=&quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>url<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot;;&lt;/script&gt;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   <span class="token comment">/**
    * @name alertAndBack 弹窗消息并返回
    * @param {string} msg 弹出的消息
    * @param {*} resp Response对象
    */</span>
   <span class="token keyword">static</span> <span class="token function">alertAndBack</span><span class="token punctuation">(</span><span class="token parameter">msg<span class="token punctuation">,</span> resp</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      resp<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;script&gt;alert(&quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>msg<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot;);history.back();&lt;/script&gt;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
   
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> MessageBox<span class="token punctuation">;</span>
</code></pre></div><p>将上面的方法放在<code>utils</code>这个文件夹中，在需要的地方导入这个对象</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>MessageBox<span class="token punctuation">.</span><span class="token function">alertAndBack</span><span class="token punctuation">(</span><span class="token string">&quot;这是消息框&quot;</span><span class="token punctuation">,</span>resp<span class="token punctuation">)</span><span class="token punctuation">;</span>
MessageBox<span class="token punctuation">.</span><span class="token function">alertAndRedirect</span><span class="token punctuation">(</span><span class="token string">&quot;这是消息框 ，点击确定后转向&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;/Main/Index&quot;</span><span class="token punctuation">,</span>resp<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="nodejs配置启动信息"><a href="#nodejs配置启动信息" class="header-anchor">#</a> NodeJS配置启动信息</h2> <p>一般情况下，可以使用<code>node</code>命令直接启动某一个项目或运行某一个<code>JS</code>文件，但是在大型的项目里，需要将项目的启动命令配置在项目信息文件<code>package.json</code> 里</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// package.json</span>
<span class="token punctuation">{</span>
    <span class="token comment">// ......</span>
    <span class="token string">&quot;scripts&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
        <span class="token string">&quot;start&quot;</span><span class="token operator">:</span> <span class="token string">&quot;node app.js&quot;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// ......</span>
<span class="token punctuation">}</span>
</code></pre></div><p>在<code>package.json</code>里面配置了启动信息后，就可以直接启动这个命令</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">npm</span> run start
</code></pre></div><p><code>start</code>是<code>package.json</code>自带的命令，如下图所示</p> <p><img src="/img/nodejs/Express-6.png" alt="Express-6"></p> <p>这些提示信息的命令都是系统内置命令，如果是系统内置的命令，可以省略掉<code>run</code></p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">npm</span> start
</code></pre></div><p>对于非系统的自带命令，一定要加上<code>run</code></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token punctuation">{</span>
    <span class="token comment">// ....</span>
    <span class="token string">&quot;scripts&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
        <span class="token string">&quot;huangxukang&quot;</span><span class="token operator">:</span><span class="token string">&quot;node app.js&quot;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// ......</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>huangxukang</code>不是系统自带的命令，所以<code>run</code>关键字就不能省略</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">npm</span> run huangxukang
</code></pre></div><p><strong>在使用时尽量添加<code>run</code>关键字启动，以防止报错</strong></p> <h2 id="express创建服务器-补充"><a href="#express创建服务器-补充" class="header-anchor">#</a> Express创建服务器[补充]</h2> <p>之前通过<code>Express</code>创建服务器的步骤如下</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> express<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;express&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> app<span class="token operator">=</span><span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
     console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;服务器启动成功&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>在开发环境下，像上面写没有问题，但是项目做完最终是要上线的，上线时把项目的服务器启动改一下</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> express<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;express&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> app<span class="token operator">=</span><span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> http<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;http&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> server<span class="token operator">=</span>http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span>app<span class="token punctuation">)</span><span class="token punctuation">;</span>

server<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
   console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;服务器启动成功&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="express对cookie的操作"><a href="#express对cookie的操作" class="header-anchor">#</a> Express对Cookie的操作</h2> <blockquote><p><code>Express</code>默认不支持<code>cookie</code>，如果要进行<code>cookie</code>的操作，需要借用第三方模块<code>cookie-parser</code></p></blockquote> <p><strong>第一步：安装模块</strong></p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">npm</span> <span class="token function">install</span> cookie-parser --save
</code></pre></div><p>或</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">yarn</span> <span class="token function">add</span> cookie-parser
</code></pre></div><p><strong>第二步：加载模块</strong></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> cookieParser<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;cookie-parser&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// express加载第三方插件使用use方法</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">cookieParser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>第三步：cookie取值</strong></p> <p><code>cookie</code>随着浏览器的请求到达服务器，所以要找<code>request</code>对象<code>req</code></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>req<span class="token punctuation">.</span>cookies<span class="token punctuation">.</span>userName<span class="token punctuation">;</span> <span class="token comment">// 取值cookie里面的userName</span>
</code></pre></div><p><strong>第四步：cookie赋值</strong></p> <p><code>cookie</code>应该随着随着服务器响应<code>response</code>的对象<code>resp</code>返回到浏览器</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>resp<span class="token punctuation">.</span><span class="token function">cookie</span><span class="token punctuation">(</span><span class="token string">&quot;sex&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;女&quot;</span><span class="token punctuation">,</span><span class="token punctuation">{</span>
    maxAge<span class="token operator">:</span><span class="token number">1000</span><span class="token operator">*</span><span class="token number">60</span><span class="token operator">*</span><span class="token number">30</span><span class="token punctuation">,</span> <span class="token comment">// 设置cookie的过期时间是30分钟以后</span>
    path<span class="token operator">:</span><span class="token string">&quot;/&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>清除cookie</strong></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code> resp<span class="token punctuation">.</span><span class="token function">clearCookie</span><span class="token punctuation">(</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 清除age的cookie</span>
</code></pre></div><p><strong>加密的Cookie</strong></p> <p>因为<code>cookie</code>是直接存放在浏览器的，所有用户都可以看到这个<code>cookie</code>信息，这样做很不安全，所以<code>Express</code>里内置了一套<code>cookie</code>的加密机制</p> <p><strong>第一步：在加载cookieParser这个插件的时候，给一个加密码</strong></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">cookieParser</span><span class="token punctuation">(</span><span class="token string">&quot;aaabbb&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>第二步：在设置cookie的时候，把这个cookie设置为签名cookie(可以理解为加密cookie)</strong></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code> resp<span class="token punctuation">.</span><span class="token function">cookie</span><span class="token punctuation">(</span><span class="token string">&quot;userName&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;黄旭康&quot;</span><span class="token punctuation">,</span><span class="token punctuation">{</span>
     maxAge<span class="token operator">:</span><span class="token number">1000</span><span class="token operator">*</span><span class="token number">60</span><span class="token operator">*</span><span class="token number">30</span><span class="token punctuation">,</span>
     signed<span class="token operator">:</span><span class="token boolean">true</span> <span class="token comment">// 代表使用签名的cookie（加密cookie）</span>
 <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p><strong>第三步：获取加密的cookie</strong></p> <p>通过普通方式<code>req.cookie.userName</code>只能获取普通的未加密的<code>cookie</code> , 如果是加密的<code>cookie</code>则不能获取</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>req<span class="token punctuation">.</span>signedCookies<span class="token punctuation">.</span>userName<span class="token punctuation">;</span> <span class="token comment">// 获取到加密的cookie值“黄旭康”</span>
</code></pre></div><blockquote><p>始终都要记得，<code>cookie</code>是以文档(<code>document</code>)为单位存储的，它会随着浏览器的请求到服务器，也会随着服务器的响应到浏览器，所以<code>cookie</code>的存值不应过大，过大则可能出现丢失的情况，也有可能出现访问变慢的情况</p></blockquote> <h2 id="express实现中转服务器"><a href="#express实现中转服务器" class="header-anchor">#</a> Express实现中转服务器</h2> <p>前端的<code>ajax</code>不允许跨域请求数据的，这时可以使用<code>nodejs</code>来进行一次中转操作</p> <p><strong>第一步：创建路由</strong></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">&quot;/maoyanApi&quot;</span><span class="token punctuation">,</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./routes/maoyanApiRoute&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>第二步：在路由里建议代理</strong></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> router<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;express&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> axios<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;axios&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> baseURL<span class="token operator">=</span><span class="token string">&quot;http://m.maoyan.com&quot;</span><span class="token punctuation">;</span>  <span class="token comment">//原始的地址就是这一个</span>
router<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token regex">/\/.*/</span><span class="token punctuation">,</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>resp</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token keyword">let</span> method<span class="token operator">=</span>req<span class="token punctuation">.</span>method<span class="token punctuation">;</span>    <span class="token comment">//得到请求方式</span>
    <span class="token keyword">let</span> url <span class="token operator">=</span> req<span class="token punctuation">.</span>url<span class="token punctuation">;</span>   <span class="token comment">//这个地址不包含路由的路径 maoyanApi</span>
    <span class="token keyword">let</span> result<span class="token operator">=</span><span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>method<span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token string">&quot;GET&quot;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
       result <span class="token operator">=</span> <span class="token keyword">await</span> axios<span class="token punctuation">.</span>default<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>baseURL<span class="token operator">+</span>url<span class="token punctuation">,</span><span class="token punctuation">{</span>
           responseType<span class="token operator">:</span><span class="token string">&quot;stream&quot;</span>
       <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>method<span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token string">&quot;POST&quot;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        result<span class="token operator">=</span> <span class="token keyword">await</span> axios<span class="token punctuation">.</span>default<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span>baseURL<span class="token operator">+</span>url<span class="token punctuation">,</span>req<span class="token punctuation">.</span>body<span class="token punctuation">,</span><span class="token punctuation">{</span>
            responseType<span class="token operator">:</span><span class="token string">&quot;stream&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// resp.send(JSON.stringify(result.data));</span>
    result<span class="token punctuation">.</span>data<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>resp<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports<span class="token operator">=</span>router<span class="token punctuation">;</span>
</code></pre></div><ul><li><code>router.all()</code>代表接收所有的请求方式</li> <li><code>/\/.*/</code>代表接收所有的请求路径</li> <li>使用流的方式响应数据，然后以流的信息直接对接到<code>resp</code> 上面</li></ul> <p>代码完成后，就可以实现请求代理</p> <p><strong>新地址</strong></p> <div class="language-http extra-class"><pre class="language-http"><code><span class="token header-name keyword">http:</span>//127.0.0.1:8888/maoyanApi/ajax/comingList?token=
</code></pre></div><p><strong>原地址</strong></p> <div class="language-http extra-class"><pre class="language-http"><code><span class="token header-name keyword">http:</span>//m.maoyan.com/ajax/comingList?token=
</code></pre></div><h2 id="express返回json"><a href="#express返回json" class="header-anchor">#</a> Express返回JSON</h2> <blockquote><p><code>Express</code>的<code>resp</code>可以渲染对象，也可以<code>send</code>字符串</p> <p>将一个对象通过<code>JSON.stringify()</code>序列化成<code>json</code>字符串后再通过<code>resp.send()</code>发送到页面</p></blockquote> <p>如果前端需要设置<code>CORS</code>跨域，服务器应该怎么设置呢</p> <p><strong>app.js代码</strong></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;/getList&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> resp</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
        userName<span class="token operator">:</span> <span class="token string">&quot;杨标&quot;</span><span class="token punctuation">,</span>
        sex<span class="token operator">:</span> <span class="token string">&quot;男&quot;</span><span class="token punctuation">,</span>
        age<span class="token operator">:</span> <span class="token number">18</span><span class="token punctuation">,</span>
        hobby<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;看书&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;睡觉&quot;</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> jsonStr<span class="token operator">=</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//将对象序列化成json字符串</span>
    resp<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">&quot;Access-Control-Allow-Headers&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;Content-Type&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    resp<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">&quot;Access-Control-Allow-Methods&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;GET,POST,PUT,DELETE,OPTIONS&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    resp<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">&quot;Access-Control-Allow-Origin&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;*&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    resp<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>jsonStr<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>在服务器里，将得到的<code>obj</code>对象通过<code>JSON.stringify(obj)</code>变成了<code>json</code>字符串，然后调用<code>resp.send()</code>方法发送到浏览器，浏览器通过<code>ajax</code>接收到的就是<code>json</code>字符串，它是 <code>string</code>，如果需要使用，在浏览器调用<code>JSON.parse()</code>重新转化成<code>js</code>对象</p> <p><strong>浏览器代码</strong></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">$</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;#btn1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        $<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;http://127.0.0.1:8888/getList&quot;</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token comment">// data 就是服务器返回的数据</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//string </span>
            <span class="token comment">//如果要拿到里面的属性，应该怎么办</span>
            <span class="token keyword">var</span> jsonObj <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> jsonObj<span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">//object</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>jsonObj<span class="token punctuation">.</span>userName<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>在之前使用<code>Ajax</code>请求时，返回的都是一个对象，不需要调用<code>JSON.parse()</code>的方法去转换，现在我们的服务器为什么不行呢</p> <p><img src="/img/nodejs/Express-7.png" alt="Express-7"></p> <p>通过上面的图，可以看到，在服务器里，把对象转成<code>json</code>字符串，而在浏览器里，又把<code>json</code>字符串成对象</p> <p>在调用<code>resp.send()</code>返回之前，如果添加了如下的响应头</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>resp<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">&quot;Content-Type&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;application/json&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>则前端在接收到时，数据会自动的做一次<code>JSON.parse()</code>的转换，这时得到的就是一个<code>js</code>对象</p> <p><strong>添加请求头以后的代码</strong></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;/getList2&quot;</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>resp</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
        userName<span class="token operator">:</span> <span class="token string">&quot;杨标&quot;</span><span class="token punctuation">,</span>
        sex<span class="token operator">:</span> <span class="token string">&quot;男&quot;</span><span class="token punctuation">,</span>
        age<span class="token operator">:</span> <span class="token number">18</span><span class="token punctuation">,</span>
        hobby<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;看书&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;睡觉&quot;</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    resp<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">&quot;Access-Control-Allow-Headers&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;Content-Type&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    resp<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">&quot;Access-Control-Allow-Methods&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;GET,POST,PUT,DELETE,OPTIONS&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    resp<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">&quot;Access-Control-Allow-Origin&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;*&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> jsonStr<span class="token operator">=</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//将对象序列化成json字符串</span>
    <span class="token comment">//添加一个响应类型 </span>
    resp<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">&quot;Content-Type&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;application/json&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    resp<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>jsonStr<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>所以通过Ajax去接收时，一定要注意返回的数据到底是什么类型，如果是JSON字符串，则要手动的做一次转换，如果是对象则不用转了</strong></p> <p>这一种方式虽然简化了前面的操作，但是在<code>Express</code>里又多了一步操作，所以<code>Express</code>考虑到这种情况以后，直接推出了一个新的方法<code>resp.json();</code></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;/getList3&quot;</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>resp</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
        userName<span class="token operator">:</span> <span class="token string">&quot;杨标&quot;</span><span class="token punctuation">,</span>
        sex<span class="token operator">:</span> <span class="token string">&quot;男&quot;</span><span class="token punctuation">,</span>
        age<span class="token operator">:</span> <span class="token number">18</span><span class="token punctuation">,</span>
        hobby<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;看书&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;睡觉&quot;</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    resp<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">&quot;Access-Control-Allow-Headers&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;Content-Type&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    resp<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">&quot;Access-Control-Allow-Methods&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;GET,POST,PUT,DELETE,OPTIONS&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    resp<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">&quot;Access-Control-Allow-Origin&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;*&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//没有设置请头，直接把对象放了进去</span>
    resp<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p><code>resp.json()</code>方法相当于把对象序列化成<code>json</code>字符串后再给它添加一个<code>application/json</code>的请求头，前端在接收到数据时，就直接是一个对象，不需要再转换</p> <p>这种操作既方便了后端，也方便了前端，所以需要在<code>Express</code>里面返回一个<code>json</code>字符串到前端去时，可以调用这个方法</p> <h3 id="通过拦截器来设置请求头"><a href="#通过拦截器来设置请求头" class="header-anchor">#</a> 通过拦截器来设置请求头</h3> <p>在上面的三个请求里， 每次都设置了跨域请求头，这样很麻烦 ，可以利用<code>Express</code>拦截器来完成这个操作</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">//添加一个拦截器，给响应的请求添加请求头</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>resp<span class="token punctuation">,</span>next</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    resp<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">&quot;Access-Control-Allow-Headers&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;Content-Type&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    resp<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">&quot;Access-Control-Allow-Methods&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;GET,POST,PUT,DELETE,OPTIONS&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    resp<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">&quot;Access-Control-Allow-Orogin&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;*&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//放行</span>
    <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>只需在所有的请求前面添加上面的拦截器，这样所有请求的返回就都可以添加上面的请求头了</p> <h2 id="express请求方式"><a href="#express请求方式" class="header-anchor">#</a> Express请求方式</h2> <blockquote><ul><li><p><code>app</code>与<code>Router</code>的处理请求方式里，有<code>app.get()，app.post()</code></p></li> <li><p><code>Express</code>里<code>get</code>请求参数通过<code>req.query</code>的方式获取，<code>post</code>请求参数通过<code>req.body</code>的方式获取</p></li></ul></blockquote> <div class="language-javascript extra-class"><pre class="language-javascript"><code>router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;/List&quot;</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>resp</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>query<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
router<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&quot;/List&quot;</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>resp</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="路径变量pathvariable"><a href="#路径变量pathvariable" class="header-anchor">#</a> 路径变量pathVariable</h3> <blockquote><p>字面意义理解就是把变量放在请求路径里</p></blockquote> <div class="language-javascript extra-class"><pre class="language-javascript"><code>router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;/checkSid/:sid&quot;</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>resp</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token keyword">let</span> arr<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">&quot;1001&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;1002&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;1003&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token comment">// let sid=req.params.sid;</span>
    <span class="token keyword">let</span> <span class="token punctuation">{</span>sid<span class="token punctuation">}</span><span class="token operator">=</span>req<span class="token punctuation">.</span>params<span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>sid<span class="token punctuation">)</span><span class="token punctuation">;</span>
    resp<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>arr<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>sid<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>这时前端的请求地址就应该变成 <code>http://127.0.0.1:8888/StuInfo/checkSid/1001</code>，最后面的<code>1001</code>代表路径变量参数<code>:sid</code></p> <p>路径变量的参数取值使用<code>req.params</code>来进行</p> <p>路径变量还可以放多个参数</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;/checkSid/:sid/:userName&quot;</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>resp</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token keyword">let</span> arr<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">&quot;1001&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;1002&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;1003&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token comment">// let sid=req.params.sid;</span>
    <span class="token keyword">let</span> <span class="token punctuation">{</span>sid<span class="token punctuation">,</span>userName<span class="token punctuation">}</span><span class="token operator">=</span>req<span class="token punctuation">.</span>params<span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>sid<span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>userName<span class="token punctuation">)</span><span class="token punctuation">;</span>
    resp<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>arr<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>sid<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>请求的<code>url</code>为<code>http://127.0.0.1:8888/StuInfo/checkSid/1001/yangbiao</code></p> <blockquote><p>优点：</p> <ul><li><p>定义了参数后必须要传递参数，如果不传，找不到路径，报404错误</p></li> <li><p>这一种请求方式既可以以路径变量的方式向后台传值 ，也可以以<code>post</code>的方式向后台传值，一次请求，两种传递方式</p></li></ul></blockquote> <div class="language-javascript extra-class"><pre class="language-javascript"><code>router<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&quot;/doCheckSid/:sid/:userName&quot;</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>resp</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>params<span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span>
    resp<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&quot;我收到你的数据了&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>这个地方的<code>sid</code>与<code>userName</code>是通过路径变量传递过来的，而后面的其它参数则是通过<code>post</code>传递过来的</p> <p><img src="/img/nodejs/Express-8.png" alt="Express-8"></p> <h2 id="express多功能请求方式"><a href="#express多功能请求方式" class="header-anchor">#</a> Express多功能请求方式</h2> <p>当一个路由需要通过多种请求方式接收路径请求时，建议使用<code>all</code>的方法</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>router<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token string">&quot;/test&quot;</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>resp</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token comment">// console.log(req.query.sid);</span>
    <span class="token keyword">let</span> sid <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">param</span><span class="token punctuation">(</span><span class="token string">&quot;sid&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> sname<span class="token operator">=</span>req<span class="token punctuation">.</span><span class="token function">param</span><span class="token punctuation">(</span><span class="token string">&quot;sname&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>sid<span class="token punctuation">,</span>sname<span class="token punctuation">)</span><span class="token punctuation">;</span>
    resp<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&quot;我收到test的数据了&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><code>all</code>可以接收所有的请求类型，在接收值方面，建议使用 <code>req.param()</code> 的方法来接值，这种接值不针对请求方式，只要传值了，无论以何种方式进来的，一定可以接收到</p> <h2 id="express接收前台传值总结"><a href="#express接收前台传值总结" class="header-anchor">#</a> Express接收前台传值总结</h2> <table><thead><tr><th>传值方式</th> <th>服务器接收值方式</th> <th>备注</th></tr></thead> <tbody><tr><td><code>router.get(&quot;/List&quot;)</code></td> <td>req.query</td> <td></td></tr> <tr><td><code>router.post(&quot;/List&quot;)</code></td> <td>req.body</td> <td></td></tr> <tr><td><code>router.get(&quot;/List/:sid&quot;)</code></td> <td>req.params</td> <td>pathVariable具体参照上个章节</td></tr> <tr><td><code>router.all(&quot;/List&quot;)</code></td> <td>req.param()</td> <td>这是一个方法，可以接收任何方式传过来的值</td></tr></tbody></table> <h2 id="分页的补充"><a href="#分页的补充" class="header-anchor">#</a> 分页的补充</h2> <p>在分页时数据量比较小还没有什么，如果数据量比较大，就出问题了，如图所示</p> <p><img src="/img/nodejs/Express-9.png" alt="Express-9"></p> <p>这时可以看到右下脚的页数过多</p> <p><strong>解决思路</strong></p> <p>之前的分页数据是通过<code>PageModel</code>的对象来进行</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">/**
 * @description 分页配置信息
 */</span>

<span class="token keyword">const</span> appConfig <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;../config/appConfig.js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @class pageModel
 * @description 分页信息
 */</span>
<span class="token keyword">class</span> <span class="token class-name">pageModel</span> <span class="token punctuation">{</span>
    <span class="token comment">/**
     * @param {Number} totalCount 总数
     * @param {Number} pageIndex 页码
     */</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">totalCount<span class="token punctuation">,</span> pageIndex</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>totalCount <span class="token operator">=</span> totalCount<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>pageIndex <span class="token operator">=</span> pageIndex<span class="token punctuation">;</span>
        <span class="token comment">// 总的页数</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>pageCount <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">ceil</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>totalCount <span class="token operator">/</span> appConfig<span class="token punctuation">.</span>pageSize<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 页码过多手动指定开始与结束</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>pageStart <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>pageIndex <span class="token operator">-</span> <span class="token number">4</span> <span class="token operator">&gt;</span> <span class="token number">1</span> <span class="token operator">?</span> <span class="token keyword">this</span><span class="token punctuation">.</span>pageIndex <span class="token operator">-</span> <span class="token number">4</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>pageEnd <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>pageStart <span class="token operator">+</span> <span class="token number">9</span> <span class="token operator">&lt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>pageCount <span class="token operator">?</span> <span class="token keyword">this</span><span class="token punctuation">.</span>pageStart <span class="token operator">+</span> <span class="token number">9</span> <span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>pageCount<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> pageModel<span class="token punctuation">;</span>
</code></pre></div><p>在这个对象上面，又添加了两个新的属性，<code>pageStart</code>和<code>pageEnd</code>，这两个值不固定</p> <p>在前端的模板渲染里，更改代码</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token comment">&lt;!-- 通用分页，子级模板页默认共享父级模板页的数据，同时父级模板页也可以单独传递数据给子级模板页 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>clearfix<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>pagination pull-right<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!-- art-template原始语法，同时给当前页码加上颜色标注 --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">data-pageindex</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>1<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>#<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>首页<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
        &lt;%for(var i=pageModel.pageStart;i&lt;=pageModel.pageEnd;i++){%&gt;
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>{{pageModel.pageIndex==i?'active':''}}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">data-pageindex</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>{{i}}<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>#<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>{{i}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
        &lt;%}%&gt;
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">data-pageindex</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>{{pageModel.pageCount}}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>尾页<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    <span class="token keyword">if</span> <span class="token punctuation">(</span>location<span class="token punctuation">.</span>search <span class="token operator">==</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;.pagination&gt;li&gt;a&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">each</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">index<span class="token punctuation">,</span> ele</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">var</span> pageindex <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">&quot;data-pageindex&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">$</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">&quot;href&quot;</span><span class="token punctuation">,</span> location<span class="token punctuation">.</span>pathname <span class="token operator">+</span> <span class="token string">&quot;?pageindex=&quot;</span> <span class="token operator">+</span> pageindex<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;.pagination&gt;li&gt;a&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">each</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">index<span class="token punctuation">,</span> ele</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">var</span> pageindex <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">&quot;data-pageindex&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 只需要把pageIndex更换为具体的值</span>
            <span class="token keyword">var</span> s <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">URLSearchParams</span><span class="token punctuation">(</span>location<span class="token punctuation">.</span>search<span class="token punctuation">)</span><span class="token punctuation">;</span>
            s<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;pageIndex&quot;</span><span class="token punctuation">,</span> pageindex<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">$</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">&quot;href&quot;</span><span class="token punctuation">,</span> location<span class="token punctuation">.</span>pathname <span class="token operator">+</span> <span class="token string">&quot;?&quot;</span> <span class="token operator">+</span> s<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>再进行模板渲染时就已经变成了<code>pageStart</code>与<code>pageEnd</code></p> <p><img src="/img/nodejs/Express-10.png" alt="Express-10"></p> <h2 id="回调地址应用"><a href="#回调地址应用" class="header-anchor">#</a> 回调地址应用</h2> <p>在之前的操作里，如果由列表页面点击编辑调转到编辑页面，无论是直接返回还是点击保存数据以后返回，都直接跳转去首页了，这个不是很方便</p> <p>例如，当用户点击搜索或分页到某一个页面后，如果再次点击编辑，保存数据或返回时，应该跳到之前的某一个编辑或搜索结果页面</p> <p><strong>第一步：添加<code>callBackUrl</code>参数</strong></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 编辑按钮</span>
         <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;.btn-edit&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">var</span> ckLength <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;[name='ck']:checked&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length<span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>ckLength <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// 拿到选中的这个值</span>
                <span class="token keyword">var</span> sid <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;[name='ck']:checked&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// 跳转页面，告诉后台修改哪一条记录,同时返回编辑信息页面而不是回首页，encodeURIComponent地址栏加密</span>
                location<span class="token punctuation">.</span>href <span class="token operator">=</span> <span class="token string">&quot;/StuInfo/editStuInfo?sid=&quot;</span> <span class="token operator">+</span> sid <span class="token operator">+</span> <span class="token string">&quot;&amp;callBackUrl=&quot;</span> <span class="token operator">+</span>
                    <span class="token function">encodeURIComponent</span><span class="token punctuation">(</span>location<span class="token punctuation">.</span>href<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                layer<span class="token punctuation">.</span><span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">&quot;一次只能修改一项数据&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>在当前的地址后添加了<code>callBackUrl</code>参数，这个参数记录了当前的地址值，然后在后台接收到这个地址（这个地址要经过<code>encodeURIComponent</code>加密编码）</p> <p>**第二步：后台接收到值 **</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 编辑学生信息，与新增学生信息一样</span>
router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;/editStuInfo&quot;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> resp</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token comment">//拿到要修改的学生学号，根据这个学号在数据库中查询学生信息</span>
        <span class="token keyword">let</span> <span class="token punctuation">{</span>
            sid<span class="token punctuation">,</span>
            callBackUrl
        <span class="token punctuation">}</span> <span class="token operator">=</span> req<span class="token punctuation">.</span>query<span class="token punctuation">;</span>
        <span class="token comment">// let stuInfoService = new StuInfoService();</span>
        <span class="token keyword">let</span> stuInfoService <span class="token operator">=</span> ServiceFactory<span class="token punctuation">.</span><span class="token function">createStuInfoService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token keyword">await</span> stuInfoService<span class="token punctuation">.</span><span class="token function">findBySid</span><span class="token punctuation">(</span>sid<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">.</span>length <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 没有数据，可能已经被删除</span>
            <span class="token comment">// resp.send(`&lt;script&gt;alert('不能修改当前数据，可能已经被删除，请返回刷新');history.back();&lt;/script&gt;`);</span>
            MessageBox<span class="token punctuation">.</span><span class="token function">alertAndBack</span><span class="token punctuation">(</span><span class="token string">&quot;不能修改当前数据，可能已经被删除，请返回刷新&quot;</span><span class="token punctuation">,</span> resp<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token comment">// 有数据，开始渲染页面</span>
            <span class="token comment">// 得到所有班级信息，渲染到前台</span>
            <span class="token comment">// let classInfoService = new ClassInfoService();</span>
            <span class="token keyword">let</span> classInfoService <span class="token operator">=</span> ServiceFactory<span class="token punctuation">.</span><span class="token function">createClassInfoService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">let</span> classInfoList <span class="token operator">=</span> <span class="token keyword">await</span> classInfoService<span class="token punctuation">.</span><span class="token function">getAllList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 在这里在拿到民族列表</span>
            <span class="token keyword">let</span> <span class="token punctuation">{</span>
                nationList
            <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;../config/appConfig.js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            resp<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">&quot;StuInfo/editStuInfo&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
                classInfoList<span class="token punctuation">,</span>
                nationList<span class="token punctuation">,</span>
                stuInfo<span class="token operator">:</span> result<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                callBackUrl
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        resp<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&quot;服务器错误&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>第三步：前台页面记录这个值</strong></p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token comment">&lt;!-- ...... --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span> form-horizontal<span class="token punctuation">&quot;</span></span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>/StuInfo/doEditStuInfo<span class="token punctuation">&quot;</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>POST<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>hidden<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>{{callBackUrl}}<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>callBackUrl<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!-- ...... --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>{{callBackUrl||'/StuInfo/List'}}<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span> btn btn-danger<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span> glyphicon glyphicon-arrow-left<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span> 返回列表
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>这一步在页面上面拿到这个值以后还要记录下来，可以直接返回，也可以放在表单里面提交到<code>doEditStu</code>的后面，方便后台再一次操作</p> <p><strong>第四步：服务器的处理</strong></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 处理编辑学生信息的请求</span>
router<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&quot;/doEditStuInfo&quot;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> resp</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> <span class="token punctuation">{</span>
            callBackUrl
        <span class="token punctuation">}</span> <span class="token operator">=</span> req<span class="token punctuation">.</span>body<span class="token punctuation">;</span>
        <span class="token comment">// let stuInfoService = new StuInfoService();</span>
        <span class="token keyword">let</span> stuInfoService <span class="token operator">=</span> ServiceFactory<span class="token punctuation">.</span><span class="token function">createStuInfoService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> flag <span class="token operator">=</span> <span class="token keyword">await</span> stuInfoService<span class="token punctuation">.</span><span class="token function">editStuInfoBySid</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>flag<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 编辑成功后跳转到当前编辑页面而不是首页</span>
            <span class="token comment">// resp.send(`&lt;script&gt;alert(&quot;编辑成功&quot;);location.href=&quot;/StuInfo/List&quot;;&lt;/script&gt;`);</span>
            <span class="token comment">// resp.redirect(&quot;/StuInfo/List&quot;);</span>
            MessageBox<span class="token punctuation">.</span><span class="token function">alertAndRedirect</span><span class="token punctuation">(</span><span class="token string">&quot;编辑成功&quot;</span><span class="token punctuation">,</span> callBackUrl <span class="token operator">||</span> <span class="token string">&quot;/StuInfo/List&quot;</span><span class="token punctuation">,</span> resp<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token comment">// 编辑失败，后退回上一页</span>
            <span class="token comment">// resp.send(`&lt;script&gt;alert('编辑失败');history.back();&lt;/script&gt;`);</span>
            MessageBox<span class="token punctuation">.</span><span class="token function">alertAndBack</span><span class="token punctuation">(</span><span class="token string">&quot;编辑失败&quot;</span><span class="token punctuation">,</span> resp<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        resp<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&quot;服务器错误&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="nodemon插件应用"><a href="#nodemon插件应用" class="header-anchor">#</a> nodemon插件应用</h2> <p>这个插件可以监控某一个目录下的文件变化，如果变化以后自动重新启动服务器，但是在使用时候需要在<code>package.json</code>里面进行相关配置</p> <p><strong>第一步：安装模块</strong></p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">yarn</span> <span class="token function">add</span> nodemon
</code></pre></div><p><strong>第二步：配置启动命令</strong></p> <p>这一步主要是配置两个地方，第一个是配置<code>main:&quot;app.js&quot;</code>，第二个是配置<code>scripts</code>里面的<code>start</code>与<code>dev</code></p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;studentmanager&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1.0.0&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;description&quot;</span><span class="token operator">:</span> <span class="token string">&quot;学生信息管理系统&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;main&quot;</span><span class="token operator">:</span> <span class="token string">&quot;app.js&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;test&quot;</span><span class="token operator">:</span> <span class="token string">&quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;start&quot;</span><span class="token operator">:</span> <span class="token string">&quot;node app.js&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;dev&quot;</span><span class="token operator">:</span><span class="token string">&quot;nodemon --watch ./&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;keywords&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;author&quot;</span><span class="token operator">:</span> <span class="token string">&quot;黄旭康&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;license&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ISC&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;dependencies&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;art-template&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^4.13.2&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;axios&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^0.19.0&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;body-parser&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^1.19.0&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;crypto-js&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^3.1.9-1&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;express&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^4.17.1&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;express-art-template&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^1.0.1&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;express-session&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^1.17.0&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;multer&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^1.4.2&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;mysql&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^2.17.1&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;node-xlsx&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^0.15.0&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;nodemon&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^1.19.4&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;svg-captcha&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^1.4.0&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;urlencode&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^1.1.0&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>第三步：启动项目</strong></p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">npm</span> run dev
</code></pre></div><blockquote><p>dev不属于内部命令，需要添加<code>run</code></p></blockquote> <h2 id="nodejs-express-mysql-jwt接口安全验证"><a href="#nodejs-express-mysql-jwt接口安全验证" class="header-anchor">#</a> nodejs+express+mysql+jwt接口安全验证</h2> <ol><li>一段token aaa.bbb.ccc分别有头部，载荷和签名组成</li> <li>用户登录成功后服务端返回token(jwt.sign()方法)</li> <li>客户端请求其他接口，不管是post，get或者在headers里面判断是否有token（jwt.verify()）</li></ol> <p><strong>第一部分：服务器设置</strong></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> bodyParser <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'body-parser'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> jwt <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'jsonwebtoken'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> secretkey <span class="token operator">=</span> <span class="token string">'secretkey'</span><span class="token punctuation">;</span> <span class="token comment">// 加密字段</span>
<span class="token comment">// 获取数据库连接对象</span>
<span class="token keyword">var</span> connection <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./mysql/db'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 处理post字段请求</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>bodyParser<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>bodyParser<span class="token punctuation">.</span><span class="token function">urlencoded</span><span class="token punctuation">(</span><span class="token punctuation">{</span> extended<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
<span class="token comment">//建立拦截器处理跨域请求</span>
app<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token function">header</span><span class="token punctuation">(</span><span class="token string">&quot;Access-Control-Allow-Credentials&quot;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    res<span class="token punctuation">.</span><span class="token function">header</span><span class="token punctuation">(</span><span class="token string">&quot;Access-Control-Allow-Origin&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;*&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    res<span class="token punctuation">.</span><span class="token function">header</span><span class="token punctuation">(</span><span class="token string">&quot;Access-Control-Allow-Headers&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;X-Requested-With&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    res<span class="token punctuation">.</span><span class="token function">header</span><span class="token punctuation">(</span><span class="token string">&quot;Access-Control-Allow-Methods&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;PUT,POST,GET,DELETE,OPTIONS&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    res<span class="token punctuation">.</span><span class="token function">header</span><span class="token punctuation">(</span><span class="token string">&quot;Content-Type&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;application/json;charset=utf-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res<span class="token punctuation">,</span>next</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>url <span class="token operator">!=</span><span class="token string">'/user/login'</span> <span class="token operator">&amp;&amp;</span> req<span class="token punctuation">.</span>url <span class="token operator">!=</span><span class="token string">'/user/register'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// token可能存在post请求和get请求</span>
        <span class="token keyword">let</span> token <span class="token operator">=</span> req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>token <span class="token operator">||</span> req<span class="token punctuation">.</span>query<span class="token punctuation">.</span>token <span class="token operator">||</span> req<span class="token punctuation">.</span>headers<span class="token punctuation">.</span>token<span class="token punctuation">;</span>
        jwt<span class="token punctuation">.</span><span class="token function">verify</span><span class="token punctuation">(</span>token<span class="token punctuation">,</span>secretkey<span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span>decode</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
           <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">{</span>
               res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                   message<span class="token operator">:</span> <span class="token string">'token过期，请重新登录'</span><span class="token punctuation">,</span>
                   resultCode<span class="token operator">:</span> <span class="token string">'403'</span>
               <span class="token punctuation">}</span><span class="token punctuation">)</span>
           <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
               <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
        <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p><strong>第二部分：mysql的连接方法</strong></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> mysql <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'mysql'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> dbMsg <span class="token operator">=</span> <span class="token punctuation">{</span>
    host     <span class="token operator">:</span> <span class="token string">'localhost'</span><span class="token punctuation">,</span>
    user     <span class="token operator">:</span> <span class="token string">'root'</span><span class="token punctuation">,</span>
    password <span class="token operator">:</span> <span class="token string">'123456'</span><span class="token punctuation">,</span>
    database <span class="token operator">:</span> <span class="token string">'app_pro'</span>
<span class="token punctuation">}</span>
 
 
<span class="token keyword">var</span> connection <span class="token operator">=</span> mysql<span class="token punctuation">.</span><span class="token function">createConnection</span><span class="token punctuation">(</span>dbMsg<span class="token punctuation">)</span><span class="token punctuation">;</span>
    connection<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports<span class="token operator">=</span>connection<span class="token punctuation">;</span>
</code></pre></div><p><strong>第三部分：POST请求接口</strong></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'请求home成功'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
 
<span class="token comment">// 用户登录</span>
app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/user/login'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> name <span class="token operator">=</span> req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>username<span class="token punctuation">;</span>
    <span class="token keyword">var</span> passwd <span class="token operator">=</span> req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>password<span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>name<span class="token operator">||</span><span class="token operator">!</span>passwd<span class="token punctuation">)</span><span class="token punctuation">{</span>
        res<span class="token punctuation">.</span>status<span class="token operator">=</span><span class="token string">'404'</span><span class="token punctuation">;</span>
        res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            message<span class="token operator">:</span> <span class="token string">'用户名或密码错误'</span><span class="token punctuation">,</span>
            resultCode<span class="token operator">:</span> <span class="token number">1</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">var</span> userStr <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">select * from user where username=&quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot; and password=&quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>passwd<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
    connection<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>userStr<span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span>result</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">throw</span> err<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
            <span class="token keyword">var</span> token <span class="token operator">=</span> jwt<span class="token punctuation">.</span><span class="token function">sign</span><span class="token punctuation">(</span><span class="token punctuation">{</span>username<span class="token operator">:</span>name<span class="token punctuation">}</span><span class="token punctuation">,</span>secretkey<span class="token punctuation">,</span><span class="token punctuation">{</span>expiresIn<span class="token operator">:</span> <span class="token number">60</span><span class="token operator">*</span><span class="token number">8</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                message<span class="token operator">:</span> <span class="token string">'请求成功'</span><span class="token punctuation">,</span>
                token<span class="token operator">:</span> token
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// 获取用户列表</span>
app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/user/getList'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token keyword">var</span> listStr <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">select * from user</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
    connection<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>listStr<span class="token punctuation">,</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span>result</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">throw</span> err<span class="token punctuation">;</span>
        res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            message<span class="token operator">:</span> <span class="token string">'请求成功'</span><span class="token punctuation">,</span>
            resultCode<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
            info<span class="token operator">:</span> result
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// 用户注册</span>
app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/user/register'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token keyword">var</span> name <span class="token operator">=</span> req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>username<span class="token punctuation">;</span>
    <span class="token keyword">var</span> passwd <span class="token operator">=</span> req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>password<span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>name <span class="token operator">||</span> <span class="token operator">!</span>passwd<span class="token punctuation">)</span><span class="token punctuation">{</span>
        res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            message<span class="token operator">:</span> <span class="token string">'用户名或密码错误'</span><span class="token punctuation">,</span>
            resultCode<span class="token operator">:</span> <span class="token number">1</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
 
    <span class="token keyword">var</span> json <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> userStr <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">select * from user where username=&quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot; and password=&quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>passwd<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
    connection<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>userStr<span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span>result</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">throw</span> err<span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>length<span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            json<span class="token punctuation">.</span>message<span class="token operator">=</span> <span class="token string">'请求失败用户已经存在'</span><span class="token punctuation">;</span>
            json<span class="token punctuation">.</span>resultCode <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
            json<span class="token punctuation">.</span>message <span class="token operator">=</span> <span class="token string">'请求成功'</span><span class="token punctuation">;</span>
            json<span class="token punctuation">.</span>resultCode <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            <span class="token keyword">var</span> insertStr <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">insert into user (username, password) values (&quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot;, &quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>passwd<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot;)</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>insertStr<span class="token punctuation">)</span>
            connection<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>insertStr<span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">throw</span> err<span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>json<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> port <span class="token operator">=</span>  <span class="token number">3001</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span>port<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Express server listening on port '</span> <span class="token operator">+</span> port<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="mvc开发模式"><a href="#mvc开发模式" class="header-anchor">#</a> MVC开发模式</h2> <p><code>MVC</code>是一种开发模式，并不是一种技术，不针对于语言，而针于对于平台与架构</p> <p><code>c#</code>语言对应的是<code>asp.net MVC</code>或<code>MVC core</code>框架</p> <p><code>Java</code>里面以前是<code>Structs</code>，现在是<code>springMVC</code>框架</p> <p><code>php</code>里面则是<code>thinkPHP</code>框架</p> <p>在<code>NodeJS</code>里，有很多<code>MVC</code>类型的框架，<code>Express</code>、<code>KOA</code>、<code>EGG</code></p> <p>所谓的<code>MVC</code>其实就是三大块</p> <p><code>M:Model</code>模型</p> <p><code>V:View</code>视图</p> <p><code>C:Controller</code>控制器</p> <p><img src="/img/nodejs/MVC.png" alt="MVC"></p> <p>请求首先到达的是控制器，控制器根据请求路径去做相应的操作，例如通过<code>Service</code>调用数据库的方法，获取数据（<code>Model</code>），然后将这个模块渲染到特定的视图模板文件里，再将渲染好的页面返回到浏览器</p> <ul><li><p><strong>优点：</strong></p> <ol><li><p>层次结构非常明确，控制器，视图与模型分开，可以构建低耦合的开发模式</p></li> <li><p><code>MVC</code>并不是全套，可以根据相应的需求来决定是否结合</p> <p>如果仅仅只是需要返回一个视图<code>view</code>，则不需要<code>model</code></p> <p>如果仅仅只是希望返回一串<code>json</code>数据，则不需要<code>view</code></p></li></ol></li> <li><p><strong>缺点：</strong></p> <ol><li><strong>前后端结合</strong>的开发模式，视图要控制器渲染才能够显示，前端的页面代码，后端的逻辑处理，数据库处理，模块处理的代码都放在一起，项目比较臃肿</li> <li>视图与模型的结合渲染是在服务器完成的，当结合完成后，再通过<code>resp</code>返回给浏览器展示出来，这样会消耗服务器的性能</li> <li>为了解决这样的缺点，后期出现MVVM开发模式</li></ol></li></ul></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/frontend/nodejs/NodeJS常用模块.html" class="prev">
        NodeJS常用模块
      </a></span> <span class="next"><a href="/frontend/nodejs/Egg框架.html">
        Egg框架
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.93f8e8db.js" defer></script><script src="/assets/js/2.8bff3460.js" defer></script><script src="/assets/js/46.66055a0a.js" defer></script>
  </body>
</html>
